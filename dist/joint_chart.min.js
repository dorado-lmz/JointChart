(function(t,e){if(typeof define==="function"&&define.amd){define([],function(){return t["org"]=e()})}else if(typeof module==="object"&&module.exports){module.exports=e()}else{t["org"]=e()}})(this,function(){var t;var e;t=e=function(){var t=typeof window==="object"&&!!(window.SVGAngle||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"));if(!t)return function(){};var e={xmlns:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink"};var r="1.1";var n=0;function s(){var t=++n+"";return"v-"+t}function a(t){return(t||"").replace(/ /g,"Â ")}function o(t){return t===Object(t)}function l(t){return Object.prototype.toString.call(t)=="[object Array]"}function h(t){var i='<svg xmlns="'+e.xmlns+'" xmlns:xlink="'+e.xlink+'" version="'+r+'">'+(t||"")+"</svg>";var n=d(i,{async:false});return n.documentElement}function d(t,e){e=e||{};var i;try{var r=new DOMParser;if(typeof e.async!=="undefined"){r.async=e.async}i=r.parseFromString(t,"text/xml")}catch(n){i=undefined}if(!i||i.getElementsByTagName("parsererror").length){throw new Error("Invalid XML: "+t)}return i}function u(t,i,r){var n,s;if(!t)return undefined;if(typeof t==="object"){return new g(t)}i=i||{};if(t.toLowerCase()==="svg"){return new g(h())}else if(t[0]==="<"){var a=h(t);if(a.childNodes.length>1){var o=[];for(n=0,s=a.childNodes.length;n<s;n++){var l=a.childNodes[n];o.push(new g(document.importNode(l,true)))}return o}return new g(document.importNode(a.firstChild,true))}t=document.createElementNS(e.xmlns,t);for(var d in i){c(t,d,i[d])}if(Object.prototype.toString.call(r)!="[object Array]")r=[r];for(n=0,s=r[0]&&r.length||0;n<s;n++){var u=r[n];t.appendChild(u instanceof g?u.node:u)}return new g(t)}function c(t,i,r){if(i.indexOf(":")>-1){var n=i.split(":");t.setAttributeNS(e[n[0]],n[1],r)}else if(i==="id"){t.id=r}else{t.setAttribute(i,r)}}function f(t){var e,i,r;if(t){var n=/[ ,]+/;var s=t.match(/translate\((.*)\)/);if(s){e=s[1].split(n)}var a=t.match(/rotate\((.*)\)/);if(a){i=a[1].split(n)}var o=t.match(/scale\((.*)\)/);if(o){r=o[1].split(n)}}var l=r&&r[0]?parseFloat(r[0]):1;return{translate:{tx:e&&e[0]?parseInt(e[0],10):0,ty:e&&e[1]?parseInt(e[1],10):0},rotate:{angle:i&&i[0]?parseInt(i[0],10):0,cx:i&&i[1]?parseInt(i[1],10):undefined,cy:i&&i[2]?parseInt(i[2],10):undefined},scale:{sx:l,sy:r&&r[1]?parseFloat(r[1]):l}}}function p(t,e){var i=e.x*t.a+e.y*t.c+0;var r=e.x*t.b+e.y*t.d+0;return{x:i,y:r}}function v(t){var e=p(t,{x:0,y:1});var i=p(t,{x:1,y:0});var r=180/Math.PI*Math.atan2(e.y,e.x)-90;var n=180/Math.PI*Math.atan2(i.y,i.x);return{translateX:t.e,translateY:t.f,scaleX:Math.sqrt(t.a*t.a+t.b*t.b),scaleY:Math.sqrt(t.c*t.c+t.d*t.d),skewX:r,skewY:n,rotation:r}}function g(t){if(t instanceof g){t=t.node}this.node=t;if(!this.node.id){this.node.id=s()}}g.prototype={translate:function(t,e,i){i=i||{};e=e||0;var r=this.attr("transform")||"";var n=f(r);if(typeof t==="undefined"){return n.translate}r=r.replace(/translate\([^\)]*\)/g,"").trim();var s=i.absolute?t:n.translate.tx+t;var a=i.absolute?e:n.translate.ty+e;var o="translate("+s+","+a+")";this.attr("transform",(o+" "+r).trim());return this},rotate:function(t,e,i,r){r=r||{};var n=this.attr("transform")||"";var s=f(n);if(typeof t==="undefined"){return s.rotate}n=n.replace(/rotate\([^\)]*\)/g,"").trim();t%=360;var a=r.absolute?t:s.rotate.angle+t;var o=e!==undefined&&i!==undefined?","+e+","+i:"";var l="rotate("+a+o+")";this.attr("transform",(n+" "+l).trim());return this},scale:function(t,e){e=typeof e==="undefined"?t:e;var i=this.attr("transform")||"";var r=f(i);if(typeof t==="undefined"){return r.scale}i=i.replace(/scale\([^\)]*\)/g,"").trim();var n="scale("+t+","+e+")";this.attr("transform",(i+" "+n).trim());return this},bbox:function(t,e){if(!this.node.ownerSVGElement)return{x:0,y:0,width:0,height:0};var i;try{i=this.node.getBBox();i={x:i.x,y:i.y,width:i.width,height:i.height}}catch(r){i={x:this.node.clientLeft,y:this.node.clientTop,width:this.node.clientWidth,height:this.node.clientHeight}}if(t){return i}var n=this.node.getTransformToElement(e||this.node.ownerSVGElement);return P.transformRect(i,n)},text:function(t,e){t=a(t);e=e||{};var i=t.split("\n");var r=0;var n;var s=this.attr("y");if(!s){this.attr("y","0.8em")}this.attr("display",t?null:"none");this.node.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve");this.node.textContent="";var h=this.node;if(e.textPath){var d=this.find("defs");if(d.length===0){d=u("defs");this.append(d)}var c=Object(e.textPath)===e.textPath?e.textPath.d:e.textPath;if(c){var f=u("path",{d:c});d.append(f)}var p=u("textPath");if(!e.textPath["xlink:href"]&&f){p.attr("xlink:href","#"+f.node.id)}if(Object(e.textPath)===e.textPath){p.attr(e.textPath)}this.append(p);h=p.node}var v=0;for(var r=0;r<i.length;r++){var g=i[r];var m=e.lineHeight||"1em";if(e.lineHeight==="auto"){m="1.5em"}var y=P("tspan",{dy:r==0?"0em":m,x:this.attr("x")||0});y.addClass("v-line");if(g){if(e.annotations){var w=0;var x=P.annotateString(i[r],l(e.annotations)?e.annotations:[e.annotations],{offset:-v,includeAnnotationIndices:e.includeAnnotationIndices});for(var b=0;b<x.length;b++){var _=x[b];if(o(_)){var k=parseInt(_.attrs["font-size"],10);if(k&&k>w){w=k}n=P("tspan",_.attrs);if(e.includeAnnotationIndices){n.attr("annotations",_.annotations)}if(_.attrs["class"]){n.addClass(_.attrs["class"])}n.node.textContent=_.t}else{n=document.createTextNode(_||" ")}y.append(n)}if(e.lineHeight==="auto"&&w&&r!==0){y.attr("dy",w*1.2+"px")}}else{y.node.textContent=g}}else{y.addClass("v-empty-line");y.node.style.opacity=0;y.node.textContent="-"}P(h).append(y);v+=g.length+1}return this},attr:function(t,e){if(typeof e==="function"){e=e.apply(this)}if(typeof t==="undefined"){var i=this.node.attributes;var r={};for(var n=0;n<i.length;n++){r[i[n].nodeName]=i[n].nodeValue}return r}if(typeof t==="string"&&typeof e==="undefined"){return this.node.getAttribute(t)}if(typeof t==="object"){for(var s in t){if(t.hasOwnProperty(s)){c(this.node,s,t[s])}}}else{c(this.node,t,e)}return this},remove:function(){if(this.node.parentNode){this.node.parentNode.removeChild(this.node)}},append:function(t){var e=t;if(Object.prototype.toString.call(t)!=="[object Array]"){e=[t]}for(var i=0,r=e.length;i<r;i++){t=e[i];this.node.appendChild(t instanceof g?t.node:t)}return this},prepend:function(t){this.node.insertBefore(t instanceof g?t.node:t,this.node.firstChild)},svg:function(){return this.node instanceof window.SVGSVGElement?this:P(this.node.ownerSVGElement)},defs:function(){var t=this.svg().node.getElementsByTagName("defs");return t&&t.length?P(t[0]):undefined},clone:function(){var t=P(this.node.cloneNode(true));t.node.id=s();return t},findOne:function(t){var e=this.node.querySelector(t);return e?P(e):undefined},find:function(t){var e=this.node.querySelectorAll(t);return Array.prototype.map.call(e,P)},index:function(){var t=0;var e=this.node.previousSibling;while(e){if(e.nodeType===1)t++;e=e.previousSibling}return t},findParentByClass:function(t,e){e=e||this.node.ownerSVGElement;var i=this.node.parentNode;while(i&&i!==e){if(P(i).hasClass(t)){return P(i)}i=i.parentNode}return null},toLocalPoint:function(t,e){var i=this.svg().node;var r=i.createSVGPoint();r.x=t;r.y=e;try{var n=r.matrixTransform(i.getScreenCTM().inverse());var s=this.node.getTransformToElement(i).inverse()}catch(a){return r}return n.matrixTransform(s)},translateCenterToPoint:function(t){var e=this.bbox();var r=i.rect(e).center();this.translate(t.x-r.x,t.y-r.y)},translateAndAutoOrient:function(t,e,r){var n=this.scale();this.attr("transform","");this.scale(n.sx,n.sy);var s=this.svg().node;var a=this.bbox(false,r);var o=s.createSVGTransform();o.setTranslate(-a.x-a.width/2,-a.y-a.height/2);var l=s.createSVGTransform();var h=i.point(t).changeInAngle(t.x-e.x,t.y-e.y,e);l.setRotate(h,0,0);var d=s.createSVGTransform();var u=i.point(t).move(e,a.width/2);d.setTranslate(t.x+(t.x-u.x),t.y+(t.y-u.y));var c=this.node.getTransformToElement(r);var f=s.createSVGTransform();f.setMatrix(d.matrix.multiply(l.matrix.multiply(o.matrix.multiply(c))));var p=v(f.matrix);this.translate(p.translateX,p.translateY);this.rotate(p.rotation);return this},animateAlongPath:function(t,e){var i=P("animateMotion",t);var r=P("mpath",{"xlink:href":"#"+P(e).node.id});i.append(r);this.append(i);try{i.node.beginElement()}catch(n){if(document.documentElement.getAttribute("smiling")==="fake"){var s=i.node;s.animators=[];var a=s.getAttribute("id");if(a)id2anim[a]=s;var o=getTargets(s);for(var l=0,h=o.length;l<h;l++){var d=o[l];var u=new Animator(s,d,l);animators.push(u);s.animators[l]=u;u.register()}}}},hasClass:function(t){return new RegExp("(\\s|^)"+t+"(\\s|$)").test(this.node.getAttribute("class"))},addClass:function(t){if(!this.hasClass(t)){var e=this.node.getAttribute("class")||"";this.node.setAttribute("class",(e+" "+t).trim())}return this},removeClass:function(t){if(this.hasClass(t)){var e=this.node.getAttribute("class").replace(new RegExp("(\\s|^)"+t+"(\\s|$)","g"),"$2");this.node.setAttribute("class",e)}return this},toggleClass:function(t,e){if(typeof e==="function"){e=e.apply(this)}var i=typeof e==="undefined"?this.hasClass(t):!e;if(i){this.removeClass(t)}else{this.addClass(t)}return this},sample:function(t){t=t||1;var e=this.node;var i=e.getTotalLength();var r=[];var n=0;var s;while(n<i){s=e.getPointAtLength(n);r.push({x:s.x,y:s.y,distance:n});n+=t}return r},convertToPath:function(){var t=u("path");t.attr(this.attr());var e=this.convertToPathData();if(e){t.attr("d",e)}return t},convertToPathData:function(){var t=this.node.tagName.toUpperCase();switch(t){case"PATH":return this.attr("d");case"LINE":return m(this.node);case"POLYGON":return y(this.node);case"POLYLINE":return w(this.node);case"ELLIPSE":return _(this.node);case"CIRCLE":return b(this.node);case"RECT":return k(this.node)}throw new Error(t+" cannot be converted to PATH.")},findIntersection:function(t,e){var r=this.svg().node;e=e||r;var n=i.rect(this.bbox(false,e));var s=n.center();var a=n.intersectionWithLineFromCenterToPoint(t);if(!a)return undefined;var o=this.node.localName.toUpperCase();if(o==="RECT"){var l=i.rect(parseFloat(this.attr("x")||0),parseFloat(this.attr("y")||0),parseFloat(this.attr("width")),parseFloat(this.attr("height")));var h=this.node.getTransformToElement(e);var d=P.decomposeMatrix(h);var u=r.createSVGTransform();u.setRotate(-d.rotation,s.x,s.y);var c=P.transformRect(l,u.matrix.multiply(h));a=i.rect(c).intersectionWithLineFromCenterToPoint(t,d.rotation)}else if(o==="PATH"||o==="POLYGON"||o==="POLYLINE"||o==="CIRCLE"||o==="ELLIPSE"){var f=o==="PATH"?this:this.convertToPath();var p=f.sample();var v=Infinity;var g=[];for(var m=0,y=p.length;m<y;m++){var w=p[m];var x=P.createSVGPoint(w.x,w.y);x=x.matrixTransform(this.node.getTransformToElement(e));w=i.point(x);var b=w.distance(s);var _=w.distance(t)*1.1;var k=b+_;if(k<v){v=k;g=[{sample:w,refDistance:_}]}else if(k<v+1){g.push({sample:w,refDistance:_})}}g.sort(function(t,e){return t.refDistance-e.refDistance});a=g[0].sample}return a}};function m(t){t=u(t);var e=["M",t.attr("x1"),t.attr("y1"),"L",t.attr("x2"),t.attr("y2")].join(" ");return e}function y(t){t=u(t);var e=t.node.points;var i=[];var r;for(var n=0;n<e.length;n++){r=e[n];i.push(n===0?"M":"L",r.x,r.y)}i.push("Z");return i.join(" ")}function w(t){t=u(t);var e=t.node.points;var i=[];var r;for(var n=0;n<e.length;n++){r=e[n];i.push(n===0?"M":"L",r.x,r.y)}return i.join(" ")}var x=.5522847498307935;function b(t){t=u(t);var e=parseFloat(t.attr("cx"))||0;var i=parseFloat(t.attr("cy"))||0;var r=parseFloat(t.attr("r"));var n=r*x;var s=["M",e,i-r,"C",e+n,i-r,e+r,i-n,e+r,i,"C",e+r,i+n,e+n,i+r,e,i+r,"C",e-n,i+r,e-r,i+n,e-r,i,"C",e-r,i-n,e-n,i-r,e,i-r,"Z"].join(" ");return s}function _(t){t=u(t);var e=parseFloat(t.attr("cx"))||0;var i=parseFloat(t.attr("cy"))||0;var r=parseFloat(t.attr("rx"));var n=parseFloat(t.attr("ry"))||r;var s=r*x;var a=n*x;var o=["M",e,i-n,"C",e+s,i-n,e+r,i-a,e+r,i,"C",e+r,i+a,e+s,i+n,e,i+n,"C",e-s,i+n,e-r,i+a,e-r,i,"C",e-r,i-a,e-s,i-n,e,i-n,"Z"].join(" ");return o}function k(t){t=u(t);var e=parseFloat(t.attr("x"))||0;var r=parseFloat(t.attr("y"))||0;var n=parseFloat(t.attr("width"))||0;var s=parseFloat(t.attr("height"))||0;var a=parseFloat(t.attr("rx"))||0;var o=parseFloat(t.attr("ry"))||0;var l=i.rect(e,r,n,s);var h;if(!a&&!o){h=["M",l.origin().x,l.origin().y,"H",l.corner().x,"V",l.corner().y,"H",l.origin().x,"V",l.origin().y,"Z"].join(" ")}else{var d=e+n;var c=r+s;h=["M",e+a,r,"L",d-a,r,"Q",d,r,d,r+o,"L",d,r+s-o,"Q",d,c,d-a,c,"L",e+a,c,"Q",e,c,e,c-a,"L",e,r+o,"Q",e,r,e+a,r,"Z"].join(" ")}return h}function C(t){var e=t.rx||t["top-rx"]||0;var i=t.rx||t["bottom-rx"]||0;var r=t.ry||t["top-ry"]||0;var n=t.ry||t["bottom-ry"]||0;return["M",t.x,t.y+r,"v",t.height-r-n,"a",i,n,0,0,0,i,n,"h",t.width-2*i,"a",i,n,0,0,0,i,-n,"v",-(t.height-n-r),"a",e,r,0,0,0,-e,-r,"h",-(t.width-2*e),"a",e,r,0,0,0,-e,r].join(" ")}var P=u;P.isVElement=function(t){return t instanceof g};P.decomposeMatrix=v;P.rectToPath=C;var M=P("svg").node;P.createSVGMatrix=function(t){var e=M.createSVGMatrix();for(var i in t){e[i]=t[i]}return e};P.createSVGTransform=function(){return M.createSVGTransform()};P.createSVGPoint=function(t,e){var i=M.createSVGPoint();i.x=t;i.y=e;return i};P.transformRect=function(t,e){var i=M.createSVGPoint();i.x=t.x;i.y=t.y;var r=i.matrixTransform(e);i.x=t.x+t.width;i.y=t.y;var n=i.matrixTransform(e);i.x=t.x+t.width;i.y=t.y+t.height;var s=i.matrixTransform(e);i.x=t.x;i.y=t.y+t.height;var a=i.matrixTransform(e);var o=Math.min(r.x,n.x,s.x,a.x);var l=Math.max(r.x,n.x,s.x,a.x);var h=Math.min(r.y,n.y,s.y,a.y);var d=Math.max(r.y,n.y,s.y,a.y);return{x:o,y:h,width:l-o,height:d-h}};P.styleToObject=function(t){var e={};var i=t.split(";");for(var r=0;r<i.length;r++){var n=i[r];var s=n.split("=");e[s[0].trim()]=s[1].trim()}return e};P.createSlicePathData=function(t,e,i,r){var n=2*Math.PI-1e-6;var s=t;var a=e;var o=i;var l=r;var h=(l<o&&(h=o,o=l,l=h),l-o);var d=h<Math.PI?"0":"1";var u=Math.cos(o);var c=Math.sin(o);var f=Math.cos(l);var p=Math.sin(l);return h>=n?s?"M0,"+a+"A"+a+","+a+" 0 1,1 0,"+-a+"A"+a+","+a+" 0 1,1 0,"+a+"M0,"+s+"A"+s+","+s+" 0 1,0 0,"+-s+"A"+s+","+s+" 0 1,0 0,"+s+"Z":"M0,"+a+"A"+a+","+a+" 0 1,1 0,"+-a+"A"+a+","+a+" 0 1,1 0,"+a+"Z":s?"M"+a*u+","+a*c+"A"+a+","+a+" 0 "+d+",1 "+a*f+","+a*p+"L"+s*f+","+s*p+"A"+s+","+s+" 0 "+d+",0 "+s*u+","+s*c+"Z":"M"+a*u+","+a*c+"A"+a+","+a+" 0 "+d+",1 "+a*f+","+a*p+"L0,0"+"Z"};P.mergeAttrs=function(t,e){for(var i in e){if(i==="class"){t[i]=t[i]?t[i]+" "+e[i]:e[i]}else if(i==="style"){if(o(t[i])&&o(e[i])){t[i]=P.mergeAttrs(t[i],e[i])}else if(o(t[i])){t[i]=P.mergeAttrs(t[i],P.styleToObject(e[i]))}else if(o(e[i])){t[i]=P.mergeAttrs(P.styleToObject(t[i]),e[i])}else{t[i]=P.mergeAttrs(P.styleToObject(t[i]),P.styleToObject(e[i]))}}else{t[i]=e[i]}}return t};P.annotateString=function(t,e,i){e=e||[];i=i||{};offset=i.offset||0;var r=[];var n;var s=[];var a;var l;for(var h=0;h<t.length;h++){a=s[h]=t[h];for(var d=0;d<e.length;d++){var u=e[d];var c=u.start+offset;var f=u.end+offset;if(h>=c&&h<f){if(o(a)){a.attrs=P.mergeAttrs(P.mergeAttrs({},a.attrs),u.attrs)}else{a=s[h]={t:t[h],attrs:u.attrs}}if(i.includeAnnotationIndices){(a.annotations||(a.annotations=[])).push(d)}}}l=s[h-1];if(!l){n=a}else if(o(a)&&o(l)){if(JSON.stringify(a.attrs)===JSON.stringify(l.attrs)){n.t+=a.t}else{r.push(n);n=a}}else if(o(a)){r.push(n);n=a}else if(o(l)){r.push(n);n=a}else{n=(n||"")+a}}if(n){r.push(n)}return r};P.findAnnotationsAtIndex=function(t,e){if(!t)return[];var i=[];t.forEach(function(t){if(t.start<e&&e<=t.end){i.push(t)}});return i};P.findAnnotationsBetweenIndexes=function(t,e,i){if(!t)return[];var r=[];t.forEach(function(t){if(e>=t.start&&e<t.end||i>t.start&&i<=t.end||t.start>=e&&t.end<i){r.push(t)}});return r};P.shiftAnnotations=function(t,e,i){if(!t)return t;t.forEach(function(t){if(t.start>=e){t.start+=i;t.end+=i}});return t};P.sanitizeText=a;return P}();var i=function(){var t=Math;var e=t.abs;var r=t.cos;var n=t.sin;var s=t.sqrt;var a=t.min;var o=t.max;var l=t.atan;var h=t.atan2;var d=t.acos;var u=t.round;var c=t.floor;var f=t.PI;var p=t.random;var v=function(t){return 180*t/f%360};var g=function(t,e){e=e||false;t=e?t:t%360;return t*f/180};var m=function(t,e){return e*Math.round(t/e)};var y=function(t){return t%360+(t<0?360:0)};function w(t,e){if(!(this instanceof w))return new w(t,e);var i;if(e===undefined&&Object(t)!==t){i=t.split(t.indexOf("@")===-1?" ":"@");this.x=parseInt(i[0],10);this.y=parseInt(i[1],10)}else if(Object(t)===t){this.x=t.x;this.y=t.y}else{this.x=t;this.y=e}}w.prototype={toString:function(){return this.x+"@"+this.y},adhereToRect:function(t){if(t.containsPoint(this)){return this}this.x=a(o(this.x,t.x),t.x+t.width);this.y=a(o(this.y,t.y),t.y+t.height);return this},theta:function(t){t=w(t);var e=-(t.y-this.y);var i=t.x-this.x;var r=10;var n=e.toFixed(r)==0&&i.toFixed(r)==0?0:h(e,i);if(n<0){n=2*f+n}return 180*n/f},distance:function(t){return x(this,t).length()},manhattanDistance:function(t){return e(t.x-this.x)+e(t.y-this.y)},offset:function(t,e){this.x+=t||0;this.y+=e||0;return this},magnitude:function(){return s(this.x*this.x+this.y*this.y)||.01},update:function(t,e){this.x=t||0;this.y=e||0;return this},round:function(t){this.x=t?this.x.toFixed(t):u(this.x);this.y=t?this.y.toFixed(t):u(this.y);return this},normalize:function(t){var e=(t||1)/this.magnitude();this.x=e*this.x;this.y=e*this.y;return this},difference:function(t){return w(this.x-t.x,this.y-t.y)},bearing:function(t){return x(this,t).bearing()},toPolar:function(t){t=t&&w(t)||w(0,0);var e=this.x;var i=this.y;this.x=s((e-t.x)*(e-t.x)+(i-t.y)*(i-t.y));this.y=g(t.theta(w(e,i)));return this},rotate:function(t,e){e=(e+360)%360;this.toPolar(t);this.y+=g(e);var i=w.fromPolar(this.x,this.y,t);this.x=i.x;this.y=i.y;return this},move:function(t,e){var i=g(w(t).theta(this));return this.offset(r(i)*e,-n(i)*e)},changeInAngle:function(t,e,i){return w(this).offset(-t,-e).theta(i)-this.theta(i)},equals:function(t){return this.x===t.x&&this.y===t.y},snapToGrid:function(t,e){this.x=m(this.x,t);this.y=m(this.y,e||t);return this},reflection:function(t){return w(t).move(this,this.distance(t))},clone:function(){return w(this)}};w.fromPolar=function(t,i,s){s=s&&w(s)||w(0,0);var a=e(t*r(i));var o=e(t*n(i));var l=y(v(i));if(l<90){o=-o}else if(l<180){a=-a;o=-o}else if(l<270){a=-a}return w(s.x+a,s.y+o)};w.random=function(t,e,i,r){return w(c(p()*(e-t+1)+t),c(p()*(r-i+1)+i))};function x(t,e){if(!(this instanceof x))return new x(t,e);this.start=w(t);this.end=w(e)}x.prototype={toString:function(){return this.start.toString()+" "+this.end.toString()},length:function(){return s(this.squaredLength())},squaredLength:function(){var t=this.start.x;var e=this.start.y;var i=this.end.x;var r=this.end.y;return(t-=i)*t+(e-=r)*e},midpoint:function(){return w((this.start.x+this.end.x)/2,(this.start.y+this.end.y)/2)},intersection:function(t){var e=w(this.end.x-this.start.x,this.end.y-this.start.y);var i=w(t.end.x-t.start.x,t.end.y-t.start.y);var r=e.x*i.y-e.y*i.x;var n=w(t.start.x-this.start.x,t.start.y-this.start.y);var s=n.x*i.y-n.y*i.x;var a=n.x*e.y-n.y*e.x;if(r===0||s*r<0||a*r<0){return null}if(r>0){if(s>r||a>r){return null}}else{if(s<r||a<r){return null}}return w(this.start.x+s*e.x/r,this.start.y+s*e.y/r)},bearing:function(){var t=g(this.start.y);var e=g(this.end.y);var i=this.start.x;var s=this.end.x;var a=g(s-i);var o=n(a)*r(e);var l=r(t)*n(e)-n(t)*r(e)*r(a);var d=v(h(o,l));var u=["NE","E","SE","S","SW","W","NW","N"];var c=d-22.5;if(c<0)c+=360;c=parseInt(c/45);return u[c]},pointAt:function(t){var e=(1-t)*this.start.x+t*this.end.x;var i=(1-t)*this.start.y+t*this.end.y;return w(e,i)},pointOffset:function(t){return((this.end.x-this.start.x)*(t.y-this.start.y)-(this.end.y-this.start.y)*(t.x-this.start.x))/2},clone:function(){return x(this)}};function b(t,e,i,r){if(!(this instanceof b))return new b(t,e,i,r);if(e===undefined){e=t.y;i=t.width;r=t.height;t=t.x}this.x=t;this.y=e;this.width=i;this.height=r}b.prototype={toString:function(){return this.origin().toString()+" "+this.corner().toString()},equals:function(t){var e=i.rect(this).normalize();var r=i.rect(t).normalize();return e.x===r.x&&e.y===r.y&&e.width===r.width&&e.height===r.height},origin:function(){return w(this.x,this.y)},corner:function(){return w(this.x+this.width,this.y+this.height)},topRight:function(){return w(this.x+this.width,this.y)},bottomLeft:function(){return w(this.x,this.y+this.height)},center:function(){return w(this.x+this.width/2,this.y+this.height/2)},intersect:function(t){var e=this.origin();var i=this.corner();var r=t.origin();var n=t.corner();if(n.x<=e.x||n.y<=e.y||r.x>=i.x||r.y>=i.y)return null;var s=Math.max(e.x,r.x);var a=Math.max(e.y,r.y);return b(s,a,Math.min(i.x,n.x)-s,Math.min(i.y,n.y)-a)},sideNearestToPoint:function(t){t=w(t);var e=t.x-this.x;var i=this.x+this.width-t.x;var r=t.y-this.y;var n=this.y+this.height-t.y;var s=e;var a="left";if(i<s){s=i;a="right"}if(r<s){s=r;a="top"}if(n<s){s=n;a="bottom"}return a},containsPoint:function(t){t=w(t);if(t.x>=this.x&&t.x<=this.x+this.width&&t.y>=this.y&&t.y<=this.y+this.height){return true}return false},containsRect:function(t){var e=b(t).normalize();var i=e.width;var r=e.height;var n=e.x;var s=e.y;var a=this.width;var o=this.height;if((a|o|i|r)<0){return false}var l=this.x;var h=this.y;if(n<l||s<h){return false}a+=l;i+=n;if(i<=n){if(a>=l||i>a)return false}else{if(a>=l&&i>a)return false}o+=h;r+=s;if(r<=s){if(o>=h||r>o)return false}else{if(o>=h&&r>o)return false}return true},pointNearestToPoint:function(t){t=w(t);if(this.containsPoint(t)){var e=this.sideNearestToPoint(t);switch(e){case"right":return w(this.x+this.width,t.y);case"left":return w(this.x,t.y);case"bottom":return w(t.x,this.y+this.height);case"top":return w(t.x,this.y)}}return t.adhereToRect(this)},intersectionWithLineFromCenterToPoint:function(t,e){t=w(t);var i=w(this.x+this.width/2,this.y+this.height/2);var r;if(e)t.rotate(i,e);var n=[x(this.origin(),this.topRight()),x(this.topRight(),this.corner()),x(this.corner(),this.bottomLeft()),x(this.bottomLeft(),this.origin())];var s=x(i,t);for(var a=n.length-1;a>=0;--a){var o=n[a].intersection(s);if(o!==null){r=o;break}}if(r&&e)r.rotate(i,-e);return r},moveAndExpand:function(t){this.x+=t.x||0;this.y+=t.y||0;this.width+=t.width||0;this.height+=t.height||0;return this},round:function(t){this.x=t?this.x.toFixed(t):u(this.x);this.y=t?this.y.toFixed(t):u(this.y);this.width=t?this.width.toFixed(t):u(this.width);this.height=t?this.height.toFixed(t):u(this.height);return this},normalize:function(){var t=this.x;var e=this.y;var i=this.width;var r=this.height;if(this.width<0){t=this.x+this.width;i=-this.width}if(this.height<0){e=this.y+this.height;r=-this.height}this.x=t;this.y=e;this.width=i;this.height=r;return this},bbox:function(t){var i=g(t||0);var s=e(n(i));var a=e(r(i));var o=this.width*a+this.height*s;var l=this.width*s+this.height*a;return b(this.x+(this.width-o)/2,this.y+(this.height-l)/2,o,l)},snapToGrid:function(t,e){var i=this.origin().snapToGrid(t,e);var r=this.corner().snapToGrid(t,e);this.x=i.x;this.y=i.y;this.width=r.x-i.x;this.height=r.y-i.y;return this},clone:function(){return b(this)}};function _(t,e,i){if(!(this instanceof _))return new _(t,e,i);t=w(t);this.x=t.x;this.y=t.y;this.a=e;this.b=i}_.prototype={toString:function(){return w(this.x,this.y).toString()+" "+this.a+" "+this.b},bbox:function(){return b(this.x-this.a,this.y-this.b,2*this.a,2*this.b)},intersectionWithLineFromCenterToPoint:function(t,e){t=w(t);if(e)t.rotate(w(this.x,this.y),e);var i=t.x-this.x;var r=t.y-this.y;var n;if(i===0){n=this.bbox().pointNearestToPoint(t);if(e)return n.rotate(w(this.x,this.y),-e);return n}var a=r/i;var o=a*a;var l=this.a*this.a;var h=this.b*this.b;var d=s(1/(1/l+o/h));d=i<0?-d:d;var u=a*d;n=w(this.x+d,this.y+u);if(e)return n.rotate(w(this.x,this.y),-e);return n},clone:function(){return _(this)}};var k={curveThroughPoints:function(t){var e=this.getCurveControlPoints(t);var i=["M",t[0].x,t[0].y];for(var r=0;r<e[0].length;r++){i.push("C",e[0][r].x,e[0][r].y,e[1][r].x,e[1][r].y,t[r+1].x,t[r+1].y)}return i},getCurveControlPoints:function(t){var e=[];var i=[];var r=t.length-1;var n;if(r==1){e[0]=w((2*t[0].x+t[1].x)/3,(2*t[0].y+t[1].y)/3);i[0]=w(2*e[0].x-t[0].x,2*e[0].y-t[0].y);return[e,i]}var s=[];for(n=1;n<r-1;n++){s[n]=4*t[n].x+2*t[n+1].x}s[0]=t[0].x+2*t[1].x;s[r-1]=(8*t[r-1].x+t[r].x)/2;var a=this.getFirstControlPoints(s);for(n=1;n<r-1;++n){s[n]=4*t[n].y+2*t[n+1].y}s[0]=t[0].y+2*t[1].y;s[r-1]=(8*t[r-1].y+t[r].y)/2;var o=this.getFirstControlPoints(s);for(n=0;n<r;n++){e.push(w(a[n],o[n]));if(n<r-1){i.push(w(2*t[n+1].x-a[n+1],2*t[n+1].y-o[n+1]))}else{i.push(w((t[r].x+a[r-1])/2,(t[r].y+o[r-1])/2))}}return[e,i]},getFirstControlPoints:function(t){var e=t.length;var i=[];var r=[];var n=2;i[0]=t[0]/n;for(var s=1;s<e;s++){r[s]=1/n;n=(s<e-1?4:3.5)-r[s];i[s]=(t[s]-i[s-1])/n}for(s=1;s<e;s++){i[e-s-1]-=r[e-s]*i[e-s]}return i},getInversionSolver:function(t,e,i,r){var n=arguments;function s(t,e){var i=n[t];var r=n[e];return function(n){var s=(t%3?3:1)*(e%3?3:1);var a=n.x*(i.y-r.y)+n.y*(r.x-i.x)+i.x*r.y-i.y*r.x;return s*a}}return function a(i){var r=3*s(2,3)(e);var n=s(1,3)(t)/r;var a=-s(2,3)(t)/r;var o=n*s(3,1)(i)+a*(s(3,0)(i)+s(2,1)(i))+s(2,0)(i);var l=n*s(3,0)(i)+a*s(2,0)(i)+s(1,0)(i);return l/(l-o)}},getCurveDivider:function(t,e,i,r){return function n(s){var a=x(t,e).pointAt(s);var o=x(e,i).pointAt(s);var l=x(i,r).pointAt(s);var h=x(a,o).pointAt(s);var d=x(o,l).pointAt(s);var u=x(h,d).pointAt(s);return[{p0:t,p1:a,p2:h,p3:u},{p0:u,p1:d,p2:l,p3:r}]}}};var C={linear:function(t,e,i){var r=t[1]-t[0];var n=e[1]-e[0];return(i-t[0])/r*n+e[0]||0}};return{toDeg:v,toRad:g,snapToGrid:m,normalizeAngle:y,point:w,line:x,rect:b,ellipse:_,bezier:k,scale:C}}();SVGElement.prototype.getTransformToElement=SVGElement.prototype.getTransformToElement||function(t){return t.getScreenCTM().inverse().multiply(this.getScreenCTM())};var r={dedu:{draw:{connectors:{},routers:{},util:{hashCode:function(t){var e=0;if(t.length==0)return e;for(var i=0;i<t.length;i++){var r=t.charCodeAt(i);e=(e<<5)-e+r;e=e&e}return e},getByPath:function(t,e,i){i=i||"/";var r=e.split(i);var n;while(r.length){n=r.shift();if(Object(t)===t&&n in t){t=t[n]}else{return undefined}}return t},setByPath:function(t,e,i,r){r=r||"/";var n=e.split(r);var s=t;var a=0;if(e.indexOf(r)>-1){for(var o=n.length;a<o-1;a++){s=s[n[a]]||(s[n[a]]={})}s[n[o-1]]=i}else{t[e]=i}return t},unsetByPath:function(t,e,i){i=i||"/";var r=e.lastIndexOf(i);if(r>-1){var n=joint.util.getByPath(t,e.substr(0,r),i);if(n){delete n[e.slice(r+1)]}}else{delete t[e]}return t},flattenObject:function(t,e,i){e=e||"/";var r={};for(var n in t){if(!t.hasOwnProperty(n))continue;var s=typeof t[n]==="object";if(s&&i&&i(t[n])){s=false}if(s){var a=this.flattenObject(t[n],e,i);for(var o in a){if(!a.hasOwnProperty(o))continue;r[n+e+o]=a[o]}}else{r[n]=t[n]}}return r},uuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=Math.random()*16|0;var i=t=="x"?e:e&3|8;return i.toString(16)})},guid:function(t){this.guid.id=this.guid.id||1;t.id=t.id===undefined?"j_"+this.guid.id++:t.id;return t.id},mixin:function(){var t=arguments[0];for(var e=1,i=arguments.length;e<i;e++){var r=arguments[e];if(Object(r)!==r&&!_.isFunction(r)&&(r===null||r===undefined)){continue}_.each(r,function(e,i){if(this.mixin.deep&&Object(e)===e){if(!t[i]){t[i]=_.isArray(e)?[]:{}}this.mixin(t[i],e);return}if(t[i]!==e){if(!this.mixin.supplement||!t.hasOwnProperty(i)){t[i]=e}}},this)}return t},supplement:function(){this.mixin.supplement=true;var t=this.mixin.apply(this,arguments);this.mixin.supplement=false;return t},deepMixin:function(){this.mixin.deep=true;var t=this.mixin.apply(this,arguments);this.mixin.deep=false;return t},deepSupplement:function(){this.mixin.deep=this.mixin.supplement=true;var t=this.mixin.apply(this,arguments);this.mixin.deep=this.mixin.supplement=false;return t},normalizeEvent:function(t){var e=t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0];if(e){for(var i in t){if(e[i]===undefined){e[i]=t[i]}}return e}return t},nextFrame:function(){var t;if(typeof window!=="undefined"){t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame}if(!t){var e=0;t=function(t){var i=(new Date).getTime();var r=Math.max(0,16-(i-e));var n=setTimeout(function(){t(i+r)},r);e=i+r;return n}}return function(e,i){return i?t(_.bind(e,i)):t(e)}}(),cancelFrame:function(){var t;var e=typeof window!="undefined";if(e){t=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.msCancelRequestAnimationFrame||window.oCancelAnimationFrame||window.oCancelRequestAnimationFrame||window.mozCancelAnimationFrame||window.mozCancelRequestAnimationFrame}t=t||clearTimeout;return e?_.bind(t,window):t}(),shapePerimeterConnectionPoint:function(e,r,n,s){var a;var o;if(!n){var l=r.$(".scalable")[0];var h=r.$(".rotatable")[0];if(l&&l.firstChild){n=l.firstChild}else if(h&&h.firstChild){n=h.firstChild}}if(n){o=t(n).findIntersection(s,e.paper.viewport);if(!o){a=i.rect(t(n).bbox(false,e.paper.viewport))}}else{a=r.model.getBBox();o=a.intersectionWithLineFromCenterToPoint(s)}return o||a.center()},breakText:function(e,i,r,n){n=n||{};var s=i.width;var a=i.height;var o=n.svgDocument||t("svg").node;var l=t("<text><tspan></tspan></text>").attr(r||{}).node;var h=l.firstChild;var d=document.createTextNode("");h.appendChild(d);o.appendChild(l);if(!n.svgDocument){document.body.appendChild(o)}var u=e.split(" ");var c=[];var f=[];var p;for(var v=0,g=0,m=u.length;v<m;v++){var y=u[v];d.data=f[g]?f[g]+" "+y:y;if(h.getComputedTextLength()<=s){f[g]=d.data;if(p){c[g++]=true;p=0}}else{if(!f[g]||p){var w=!!p;p=y.length-1;if(w||!p){if(!p){if(!f[g]){f=[];break}u.splice(v,2,y+u[v+1]);m--;c[g++]=true;v--;continue}u[v]=y.substring(0,p);u[v+1]=y.substring(p)+u[v+1]}else{u.splice(v,1,y.substring(0,p),y.substring(p));m++;if(g&&!c[g-1]){g--}}v--;continue}g++;v--}if(typeof a!=="undefined"){var x=x||l.getBBox().height*1.25;if(x*f.length>a){f.splice(Math.floor(a/x));break}}}if(n.svgDocument){o.removeChild(l)}else{document.body.removeChild(o)}return f.join("\n")},imageToDataUri:function(t,e){if(!t||t.substr(0,"data:".length)==="data:"){return setTimeout(function(){e(null,t)},0)}var i=document.createElement("canvas");var r=document.createElement("img");r.onload=function(){var n=i.getContext("2d");i.width=r.width;i.height=r.height;n.drawImage(r,0,0);try{var s=t.split(".").pop()||"png";var a="image/"+(s==="jpg")?"jpeg":s;var o=i.toDataURL(a)}catch(l){if(/\.svg$/.test(t)){var h=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");h.open("GET",t,false);h.send(null);var d=h.responseText;return e(null,"data:image/svg+xml,"+encodeURIComponent(d))}console.error(r.src,"fails to convert",l)}e(null,o)};r.ononerror=function(){e(new Error("Failed to load image."))};r.src=t},getElementBBox:function(e){var i=$(e);var r=i.offset();var n;if(e.ownerSVGElement){n=t(e).bbox();var s=e.getBoundingClientRect();var a=(s.width-n.width)/2;var o=(s.height-n.height)/2;n.x=r.left+a;n.y=r.top+o}else{n={x:r.left,y:r.top,width:i.outerWidth(),height:i.outerHeight()}}return n},sortElements:function(t,e){var i=$(t);var r=i.map(function(){var t=this;var e=t.parentNode;var i=e.insertBefore(document.createTextNode(""),t.nextSibling);return function(){if(e===this){throw new Error("You can't sort elements if any one is a descendant of another.")}e.insertBefore(this,i);e.removeChild(i)}});return Array.prototype.sort.call(i,e).each(function(t){r[t].call(this)})},setAttributesBySelector:function(t,e){var i=$(t);_.each(e,function(t,e){var r=i.find(e).addBack().filter(e);if(_.has(t,"class")){r.addClass(t["class"]);t=_.omit(t,"class")}r.attr(t)})},normalizeSides:function(t){if(Object(t)!==t){t=t||0;return{top:t,bottom:t,left:t,right:t}}return{top:t.top||0,bottom:t.bottom||0,left:t.left||0,
right:t.right||0}},timing:{linear:function(t){return t},quad:function(t){return t*t},cubic:function(t){return t*t*t},inout:function(t){if(t<=0)return 0;if(t>=1)return 1;var e=t*t;var i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)},exponential:function(t){return Math.pow(2,10*(t-1))},bounce:function(t){for(var e=0,i=1;1;e+=i,i/=2){if(t>=(7-4*e)/11){var r=(11-6*e-11*t)/4;return-r*r+i*i}}},reverse:function(t){return function(e){return 1-t(1-e)}},reflect:function(t){return function(e){return.5*(e<.5?t(2*e):2-t(2-2*e))}},clamp:function(t,e,i){e=e||0;i=i||1;return function(r){var n=t(r);return n<e?e:n>i?i:n}},back:function(t){if(!t)t=1.70158;return function(e){return e*e*((t+1)*e-t)}},elastic:function(t){if(!t)t=1.5;return function(e){return Math.pow(2,10*(e-1))*Math.cos(20*Math.PI*t/3*e)}}},interpolate:{number:function(t,e){var i=e-t;return function(e){return t+i*e}},object:function(t,e){var i=_.keys(t);return function(r){var n,s;var a={};for(n=i.length-1;n!=-1;n--){s=i[n];a[s]=t[s]+(e[s]-t[s])*r}return a}},hexColor:function(t,e){var i=parseInt(t.slice(1),16);var r=parseInt(e.slice(1),16);var n=i&255;var s=(r&255)-n;var a=i&65280;var o=(r&65280)-a;var l=i&16711680;var h=(r&16711680)-l;return function(t){var e=n+s*t&255;var i=a+o*t&65280;var r=l+h*t&16711680;return"#"+(1<<24|e|i|r).toString(16).slice(1)}},unit:function(t,e){var i=/(-?[0-9]*.[0-9]*)(px|em|cm|mm|in|pt|pc|%)/;var r=i.exec(t);var n=i.exec(e);var s=n[1].indexOf(".");var a=s>0?n[1].length-s-1:0;t=+r[1];var o=+n[1]-t;var l=r[2];return function(e){return(t+o*e).toFixed(a)+l}}},filter:{outline:function(t){var e='<filter><feFlood flood-color="${color}" flood-opacity="${opacity}" result="colored"/><feMorphology in="SourceAlpha" result="morphedOuter" operator="dilate" radius="${outerRadius}" /><feMorphology in="SourceAlpha" result="morphedInner" operator="dilate" radius="${innerRadius}" /><feComposite result="morphedOuterColored" in="colored" in2="morphedOuter" operator="in"/><feComposite operator="xor" in="morphedOuterColored" in2="morphedInner" result="outline"/><feMerge><feMergeNode in="outline"/><feMergeNode in="SourceGraphic"/></feMerge></filter>';var i=_.isFinite(t.margin)?t.margin:2;var r=_.isFinite(t.width)?t.width:1;return _.template(e)({color:t.color||"blue",opacity:_.isFinite(t.opacity)?t.opacity:1,outerRadius:i+r,innerRadius:i})},highlight:function(t){var e='<filter><feFlood flood-color="${color}" flood-opacity="${opacity}" result="colored"/><feMorphology result="morphed" in="SourceGraphic" operator="dilate" radius="${width}"/><feComposite result="composed" in="colored" in2="morphed" operator="in"/><feGaussianBlur result="blured" in="composed" stdDeviation="${blur}"/><feBlend in="SourceGraphic" in2="blured" mode="normal"/></filter>';return _.template(e)({color:t.color||"red",width:_.isFinite(t.width)?t.width:1,blur:_.isFinite(t.blur)?t.blur:0,opacity:_.isFinite(t.opacity)?t.opacity:1})},blur:function(t){var e=_.isFinite(t.x)?t.x:2;return _.template('<filter><feGaussianBlur stdDeviation="${stdDeviation}"/></filter>')({stdDeviation:_.isFinite(t.y)?[e,t.y]:e})},dropShadow:function(t){var e="SVGFEDropShadowElement"in window?'<filter><feDropShadow stdDeviation="${blur}" dx="${dx}" dy="${dy}" flood-color="${color}" flood-opacity="${opacity}"/></filter>':'<filter><feGaussianBlur in="SourceAlpha" stdDeviation="${blur}"/><feOffset dx="${dx}" dy="${dy}" result="offsetblur"/><feFlood flood-color="${color}"/><feComposite in2="offsetblur" operator="in"/><feComponentTransfer><feFuncA type="linear" slope="${opacity}"/></feComponentTransfer><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge></filter>';return _.template(e)({dx:t.dx||0,dy:t.dy||0,opacity:_.isFinite(t.opacity)?t.opacity:1,color:t.color||"black",blur:_.isFinite(t.blur)?t.blur:4})},grayscale:function(t){var e=_.isFinite(t.amount)?t.amount:1;return _.template('<filter><feColorMatrix type="matrix" values="${a} ${b} ${c} 0 0 ${d} ${e} ${f} 0 0 ${g} ${b} ${h} 0 0 0 0 0 1 0"/></filter>')({a:.2126+.7874*(1-e),b:.7152-.7152*(1-e),c:.0722-.0722*(1-e),d:.2126-.2126*(1-e),e:.7152+.2848*(1-e),f:.0722-.0722*(1-e),g:.2126-.2126*(1-e),h:.0722+.9278*(1-e)})},sepia:function(t){var e=_.isFinite(t.amount)?t.amount:1;return _.template('<filter><feColorMatrix type="matrix" values="${a} ${b} ${c} 0 0 ${d} ${e} ${f} 0 0 ${g} ${h} ${i} 0 0 0 0 0 1 0"/></filter>')({a:.393+.607*(1-e),b:.769-.769*(1-e),c:.189-.189*(1-e),d:.349-.349*(1-e),e:.686+.314*(1-e),f:.168-.168*(1-e),g:.272-.272*(1-e),h:.534-.534*(1-e),i:.131+.869*(1-e)})},saturate:function(t){var e=_.isFinite(t.amount)?t.amount:1;return _.template('<filter><feColorMatrix type="saturate" values="${amount}"/></filter>')({amount:1-e})},hueRotate:function(t){return _.template('<filter><feColorMatrix type="hueRotate" values="${angle}"/></filter>')({angle:t.angle||0})},invert:function(t){var e=_.isFinite(t.amount)?t.amount:1;return _.template('<filter><feComponentTransfer><feFuncR type="table" tableValues="${amount} ${amount2}"/><feFuncG type="table" tableValues="${amount} ${amount2}"/><feFuncB type="table" tableValues="${amount} ${amount2}"/></feComponentTransfer></filter>')({amount:e,amount2:1-e})},brightness:function(t){return _.template('<filter><feComponentTransfer><feFuncR type="linear" slope="${amount}"/><feFuncG type="linear" slope="${amount}"/><feFuncB type="linear" slope="${amount}"/></feComponentTransfer></filter>')({amount:_.isFinite(t.amount)?t.amount:1})},contrast:function(t){var e=_.isFinite(t.amount)?t.amount:1;return _.template('<filter><feComponentTransfer><feFuncR type="linear" slope="${amount}" intercept="${amount2}"/><feFuncG type="linear" slope="${amount}" intercept="${amount2}"/><feFuncB type="linear" slope="${amount}" intercept="${amount2}"/></feComponentTransfer></filter>')({amount:e,amount2:.5-e/2})}},format:{number:function(t,e,i){i=i||{currency:["$",""],decimal:".",thousands:",",grouping:[3]};var r=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i;var n=r.exec(t);var s=n[1]||" ";var a=n[2]||">";var o=n[3]||"";var l=n[4]||"";var h=n[5];var d=+n[6];var u=n[7];var c=n[8];var f=n[9];var p=1;var v="";var g="";var m=false;if(c)c=+c.substring(1);if(h||s==="0"&&a==="="){h=s="0";a="=";if(u)d-=Math.floor((d-1)/4)}switch(f){case"n":u=true;f="g";break;case"%":p=100;g="%";f="f";break;case"p":p=100;g="%";f="r";break;case"b":case"o":case"x":case"X":if(l==="#")v="0"+f.toLowerCase();case"c":case"d":m=true;c=0;break;case"s":p=-1;f="r";break}if(l==="$"){v=i.currency[0];g=i.currency[1]}if(f=="r"&&!c)f="g";if(c!=null){if(f=="g")c=Math.max(1,Math.min(21,c));else if(f=="e"||f=="f")c=Math.max(0,Math.min(20,c))}var y=h&&u;if(m&&e%1)return"";var w=e<0||e===0&&1/e<0?(e=-e,"-"):o;var x=g;if(p<0){var b=this.prefix(e,c);e=b.scale(e);x=b.symbol+g}else{e*=p}e=this.convert(f,e,c);var _=e.lastIndexOf(".");var k=_<0?e:e.substring(0,_);var C=_<0?"":i.decimal+e.substring(_+1);function P(t){var e=t.length;var r=[];var n=0;var s=i.grouping[0];while(e>0&&s>0){r.push(t.substring(e-=s,e+s));s=i.grouping[n=(n+1)%i.grouping.length]}return r.reverse().join(i.thousands)}if(!h&&u&&i.grouping){k=P(k)}var M=v.length+k.length+C.length+(y?0:w.length);var V=M<d?new Array(M=d-M+1).join(s):"";if(y)k=P(V+k);w+=v;e=k+C;return(a==="<"?w+e+V:a===">"?V+w+e:a==="^"?V.substring(0,M>>=1)+w+e+V.substring(M):w+(y?e:V+e))+x},string:function(t,e){var i;var r="{";var n=false;var s=[];while((i=t.indexOf(r))!==-1){var a,o,l;a=t.slice(0,i);if(n){o=a.split(":");l=o.shift().split(".");a=e;for(var h=0;h<l.length;h++)a=a[l[h]];if(o.length)a=this.number(o,a)}s.push(a);t=t.slice(i+1);r=(n=!n)?"}":"{"}s.push(t);return s.join("")},convert:function(t,e,i){switch(t){case"b":return e.toString(2);case"c":return String.fromCharCode(e);case"o":return e.toString(8);case"x":return e.toString(16);case"X":return e.toString(16).toUpperCase();case"g":return e.toPrecision(i);case"e":return e.toExponential(i);case"f":return e.toFixed(i);case"r":return(e=this.round(e,this.precision(e,i))).toFixed(Math.max(0,Math.min(20,this.precision(e*(1+1e-15),i))));default:return e+""}},round:function(t,e){return e?Math.round(t*(e=Math.pow(10,e)))/e:Math.round(t)},precision:function(t,e){return e-(t?Math.ceil(Math.log(t)/Math.LN10):1)},prefix:function(t,e){var i=_.map(["y","z","a","f","p","n","Âµ","m","","k","M","G","T","P","E","Z","Y"],function(t,e){var i=Math.pow(10,Math.abs(8-e)*3);return{scale:e>8?function(t){return t/i}:function(t){return t*i},symbol:t}});var r=0;if(t){if(t<0)t*=-1;if(e)t=this.round(t,this.precision(t,e));r=1+Math.floor(1e-12+Math.log(t)/Math.LN10);r=Math.max(-24,Math.min(24,Math.floor((r<=0?r+1:r-1)/3)*3))}return i[8+r/3]}}}}}};r.dedu.draw.Cell=Backbone.Model.extend({constructor:function(t,e){var i;var r=t||{};this.cid=_.uniqueId("c");this.attributes={};if(i=_.result(this,"defaults")){r=_.merge({},i,r)}r.redID=r.redID||(1+Math.random()*4294967295).toString(16);this.set(r,e);this.initialize.apply(this,arguments)},initialize:function(t){if(!t||!t.id){this.set("id",r.dedu.draw.util.uuid(),{silent:true})}this.processPorts()},isLink:function(){return false},toFront:function(t){if(this.collection){t=t||{};var e=(this.collection.last().get("z")||0)+1;if(t.deep){var i=this.getEmbeddedCells({deep:true,breadthFirst:true});_.each(i,function(i){i.set("z",++e,t)})}}return this},transition:function(t,e,i,r){},processPorts:function(){var t=this.ports;var e={};_.each(this.get("attrs"),function(t,i){if(t&&t.port){if(!_.isUndefined(t.port.id)){e[t.port.id]=t.port}else{e[t.port]={id:t.port}}}});this.ports=e},attr:function(t,e,i){var r=Array.prototype.slice.call(arguments);if(_.isString(t)){r[0]="attrs/"+t}else{r[0]={attrs:t}}return this.prop.apply(this,r)},prop:function(t,e,i){var n="/";if(_.isString(t)){if(arguments.length>1){var s=t;var a=s.split("/");var o=a[0];a.shift();i=i||{};i.propertyPath=s;i.propertyValue=e;if(a.length===0){return this.set(o,e,i)}var l={};var h=l;var d=o;_.each(a,function(t){h=h[d]=_.isFinite(Number(t))?[]:{};d=t});l=r.dedu.draw.util.setByPath(l,s,e,"/");var u=_.merge({},this.attributes);i.rewrite&&r.dedu.draw.util.unsetByPath(u,s,"/");var c=_.merge(u,l);return this.set(o,c[o],i)}else{return r.dedu.draw.util.getByPath(this.attributes,t,n)}}return this.set(_.merge({},this.attributes,t),e)},isEmbeddedIn:function(t,e){var i=_.isString(t)?t:t.id;var r=this.get("parent");e=_.defaults({deep:true},e);if(this.collection&&e.deep){while(r){if(r===i){return true}r=this.collection.get(r).get("parent")}return false}else{return r===i}},remove:function(t){t=t||{};var e=this.collection;if(e){}var i=this.get("parent");if(i){var r=this.collection&&this.collection.get(i);r.unembed(this)}_.invoke(this.getEmbeddedCells(),"remove",t);this.trigger("remove",this,this.collection,t);return this},getEmbeddedCells:function(t){t=t||{};if(this.collection){var e;if(t.deep){if(t.breadthFirst){e=[];var i=this.getEmbeddedCells();while(i.length>0){var r=i.shift();e.push(r);i.push.apply(i,r.getEmbeddedCells())}}else{e=this.getEmbeddedCells();_.each(e,function(i){e.push.apply(e,i.getEmbeddedCells(t))})}}else{e=_.map(this.get("embeds"),this.collection.get,this.collection)}return e}return[]},unembed:function(t,e){t.unset("parent",e);this.set("embeds",_.without(this.get("embeds"),t.id),e);return this},focus:function(){this.set("selected",true)},unfocus:function(){this.set("selected",false)},clone:function(t){t=t||{};if(!t.deep){var e=Backbone.Model.prototype.clone.apply(this,arguments);e.set("id",r.dedu.draw.util.uuid());e.set("embeds","");return e}else{return _.values(r.dedu.draw.Graph.prototype.cloneCells.call(null,[this].concat(this.getEmbeddedCells({deep:true}))))}}});r.dedu.draw.CellView=Backbone.View.extend({tagName:"g",attributes:function(){return{"model-id":this.model.id}},constructor:function(t){this._configure(t);Backbone.View.apply(this,arguments)},_configure:function(t){if(this.options)t=_.extend({},_.result(this,"options"),t);this.options=t;this.options.id=this.options.id||r.dedu.draw.util.guid(this)},initialize:function(t){},_ensureElement:function(){var e;if(!this.el){var i=_.extend({id:this.id},_.result(this,"attributes"));if(this.className)i["class"]=_.result(this,"className");e=t(_.result(this,"tagName"),i).node}else{e=_.result(this,"el")}this.setElement(e,false)},_setElement:function(e){this.$el=e instanceof Backbone.$?e:Backbone.$(e);this.el=this.$el[0];this.vel=t(this.el)},getSelector:function(e,i){if(e===this.el){return i}var r=t(e).index()+1;var n="";e.classList.forEach(function(t){n+="."+t});var s=e.tagName+n+":nth-child("+r+")";if(i){s+=" > "+i}return this.getSelector(e.parentNode,s)},getStrokeBBox:function(e){var r=!!e;e=e||this.el;var n=t(e).bbox(false,this.paper.viewport);var s;if(r){s=t(e).attr("stroke-width")}else{s=this.model.attr("rect/stroke-width")||this.model.attr("circle/stroke-width")||this.model.attr("ellipse/stroke-width")||this.model.attr("path/stroke-width")}s=parseFloat(s)||0;return i.rect(n).moveAndExpand({x:-s/2,y:-s/2,width:s,height:s})},getBBox:function(){return i.rect(this.vel.bbox())},highlight:function(t,e){t=!t?this.el:$(t,$(this.el))[0]||this.el;e=e||{};e.partial=t!=this.el;this.notify("cell:highlight",t,e);return this},unhighlight:function(t,e){t=!t?this.el:this.$(t)[0]||this.el;e=e||{};e.partial=t!=this.el;this.notify("cell:unhighlight",t,e);return this},findMagnet:function(t){var e=this.$(t);if(e.length===0||e[0]===this.el){var i=this.model.get("attrs")||{};if(i["."]&&i["."]["magnet"]===false){return undefined}return this.el}if(e.attr("magnet")){return e[0]}return this.findMagnet(e.parent())},findBySelector:function(t){var e=t==="."?this.$el:this.$el.find(t);return e},notify:function(t){if(this.paper){var e=Array.prototype.slice.call(arguments,1);this.trigger.apply(this,[t].concat(e));this.paper.trigger.apply(this.paper,[t,this].concat(e))}},pointerdblclick:function(t,e,i){this.notify("cell:pointerdblclick",t,e,i)},pointerclick:function(t,e,i){this.notify("cell:pointerclick",t,e,i)},mouseover:function(t){this.notify("cell:mouseover",t)},pointermove:function(t,e,i){this.notify("cell:pointermove",t,e,i)},pointerdown:function(t,e,i){this.notify("cell:pointerdown",t,e,i)},pointerup:function(t,e,i){this.notify("cell:pointerup",t,e,i)}});r.dedu.draw.Element=r.dedu.draw.Cell.extend({defaults:{position:{x:0,y:0},size:{width:1,height:1},angle:0,selected:false},position:function(t,e,i){},translate:function(t,e,i){t=t||0;e=e||0;if(t===0&&e===0){return this}i=i||{};i.translateBy=i.translateBy||this.id;var r=this.get("position")||{x:0,y:0};if(i.restrictedArea&&i.translateBy===this.id){}var n={x:r.x+t,y:r.y+e};i.tx=t;i.ty=e;if(!_.isObject(i.transition))i.transition={};this.set("position",n,i)},resize:function(t,e,i){this.set("size",{width:t,height:e},i);return this}});r.dedu.draw.ElementView=r.dedu.draw.CellView.extend({SPECIAL_ATTRIBUTES:["style","text","html","ref-x","ref-y","ref-dx","ref-dy","ref-width","ref-height","ref","x-alignment","y-alignment","port"],className:function(){return"element node "+this.model.get("type").replace("."," ","g")},initialize:function(t){if(t.skip_render){return}r.dedu.draw.CellView.prototype.initialize.apply(this,arguments);_.bindAll(this,"translate","resize","rotate");this.listenTo(this.model,"change:position",this.translate);this.listenTo(this.model,"change:size",this.resize);this.listenTo(this.model,"change:angle",this.rotate)},render:function(){this.$el.empty();this.renderMarkup();this.rotatableNode=this.vel.findOne(".rotatable");this.scalableNode=this.vel.findOne(".scalable");if(this.renderView){this.renderView()}this.update();this.resize();this.rotate();this.translate();return this},renderMarkup:function(){var e=this.model.get("markup")||this.model.markup;if(e){var i=t(e);this.vel.append(i)}},resize:function(){var t=this.model.get("size")||{width:1,height:1};var e=this.model.get("angle")||0;var i=this.scalableNode;if(!i){return}var r=i.bbox(true);i.attr("transform","scale("+t.width/(r.width||1)+","+t.height/(r.height||1)+")");this.update()},update:function(e,i){var r=this.model.get("attrs");var n=this.rotatableNode;if(n){var s=n.attr("transform");n.attr("transform","")}var a=[];var o={};_.each(i||r,function(e,i){var r=this.findBySelector(i);if(r.length===0)return;o[i]=r;var n=this.SPECIAL_ATTRIBUTES.slice();if(_.isObject(e.filter)){n.push("filter");this.applyFilter(r,e.filter)}if(_.isObject(e.fill)){n.push("fill");this.applyGradient(r,"fill",e.fill)}if(_.isObject(e.stroke)){n.push("stroke");this.applyGradient(r,"stroke",e.stroke)}if(!_.isUndefined(e.text)){r.each(function(){t(this).text(e.text+"",{lineHeight:e.lineHeight,textPath:e.textPath,annotations:e.annotations})});n.push("lineHeight","textPath","annotations")}var s=_.omit(e,n);r.each(function(){t(this).attr(s)});if(e.port){r.attr("port",_.isUndefined(e.port.id)?e.port:e.port.id)}if(e.style){r.css(e.style)}if(!_.isUndefined(e.html)){r.each(function(){$(this).html(e.html+"")})}if(!_.isUndefined(e["ref-x"])||!_.isUndefined(e["ref-y"])||!_.isUndefined(e["ref-dx"])||!_.isUndefined(e["ref-dy"])||!_.isUndefined(e["x-alignment"])||!_.isUndefined(e["y-alignment"])||!_.isUndefined(e["ref-width"])||!_.isUndefined(e["ref-height"])){_.each(r,function(t,e,i){var r=$(t);r.selector=i.selector;a.push(r)})}},this);var l=this.model.get("size");var h={x:0,y:0,width:l.width,height:l.height};i=i||{};_.each(a,function(e){var n=i[e.selector];var s=n?_.merge({},r[e.selector],n):r[e.selector];this.positionRelative(t(e[0]),h,s,o)},this);if(n){n.attr("transform",s||"")}},positionRelative:function(e,i,r,n){var s=r["ref"];var a=parseFloat(r["ref-dx"]);var o=parseFloat(r["ref-dy"]);var l=r["y-alignment"];var h=r["x-alignment"];var d=r["ref-y"];var u=_.isString(d)&&d.slice(-1)==="%";d=parseFloat(d);if(u){d/=100}var c=r["ref-x"];var f=_.isString(c)&&c.slice(-1)==="%";c=parseFloat(c);if(f){c/=100}var p=r["ref-width"];var v=_.isString(p)&&p.slice(-1)==="%";p=parseFloat(p);if(v){p/=100}var g=r["ref-height"];var m=_.isString(g)&&g.slice(-1)==="%";g=parseFloat(g);if(m){g/=100}var y=e.findParentByClass("scalable",this.el);if(s){var w;if(n&&n[s]){w=t(n[s][0])}else{w=s==="."?this.vel:this.vel.findOne(s)}if(!w){throw new Error("dia.ElementView: reference does not exists.")}i=w.bbox(false,this.el)}if(e.attr("transform")){e.attr("transform",e.attr("transform").replace(/translate\([^)]*\)/g,"").trim()||"")}if(isFinite(p)){if(v||p>=0&&p<=1){e.attr("width",p*i.width)}else{e.attr("width",Math.max(p+i.width,0))}}if(isFinite(g)){if(m||g>=0&&g<=1){e.attr("height",g*i.height)}else{e.attr("height",Math.max(g+i.height,0))}}var x=0;var b=0;var k;if(isFinite(a)){if(y){k=k||y.scale();x=i.x+i.width+a/k.sx}else{x=i.x+i.width+a}}if(isFinite(o)){if(y){k=k||y.scale();b=i.y+i.height+o/k.sy}else{b=i.y+i.height+o}}if(isFinite(c)){if(f||Math.abs(c)>0&&Math.abs(c)<1){x=i.x+i.width*c}else if(y){k=k||y.scale();x=i.x+c/k.sx}else{x=i.x+c}}if(isFinite(d)){if(u||Math.abs(d)>0&&Math.abs(d)<1){b=i.y+i.height*d}else if(y){k=k||y.scale();b=i.y+d/k.sy}else{b=i.y+d}}if(!_.isUndefined(l)||!_.isUndefined(h)){var C=e.bbox(false,this.paper&&this.paper.viewport||this.options.paper&&this.options.paper.viewport);if(l==="middle"){b-=C.height/2}else if(isFinite(l)){b+=l>-1&&l<1?C.height*l:l}if(h==="middle"){x-=C.width/2}else if(isFinite(h)){x+=h>-1&&h<1?C.width*h:h}}e.translate(x,b)},rotate:function(){},translate:function(){var t=this.model.get("position")||{x:0,y:0};this.vel.attr("transform","translate("+t.x+","+t.y+")")},findMagnetsInArea:function(t,e){t=i.rect(t);var r=[this.up,this.down,this.left,this.right];return _.filter(r,function(e){return e&&t.intersect(i.rect(e.bbox(false,this.paper.viewport)))},this)},pointerdown:function(t,e,n){var s=this.paper;var a=3;var o=this.findMagnetsInArea({x:e-a,y:n-a,width:2*a,height:2*a});var l;var h=Number.MAX_VALUE;var d=i.point(e,n);_.each(o,function(t){if(t.attr("magnet")!=="false"){l=i.rect(t.bbox(false,this.paper.viewport)).center().distance(d);if(l<a&&l<h){h=l;this._closestView=t}}},this);if(this._closestView||t.target.getAttribute("magnet")&&s.options.validateMagnet.call(s,this,t.target)){var u=s.getDefaultLink(this,t.target);if(this._closestView){u.set({source:{id:this.model.id,redID:this.model.get("redID"),selector:this.getSelector(this._closestView.node),port:t.target.getAttribute("port")}})}else{u.set({source:{id:this.model.id,redID:this.model.get("redID"),selector:this.getSelector(t.target),port:t.target.getAttribute("port")}})}u.set({target:{x:e,y:n}});s.model.addCell(u);this._linkView=s.findViewByModel(u);this._linkView.pointerdown(t,e,n);this._linkView.startArrowheadMove("target")}else{this._dx=e;this._dy=n;this.restrictedArea=s.getRestrictedArea(this);r.dedu.draw.CellView.prototype.pointerdown.apply(this,arguments);this.notify("element:pointerdown",t,e,n)}this._closestView=null},pointermove:function(t,e,i,n){if(this._linkView){this._linkView.pointermove(t,n.x,n.y)}else{var s=this.paper.options.gridSize;var a=_.isFunction(this.options.interactive)?this.options.interactive(this,"pointermove"):this.options.interactive;if(a!==false){this.model.translate(e,i,{restrictedArea:this.restrictedArea,ui:true})}r.dedu.draw.CellView.prototype.pointermove.apply(this,arguments);this.notify("element:pointermove",t,e,i)}},pointerup:function(t,e,i){if(this._linkView){var n=this._linkView;var s=n.model;n.pointerup(t,e,i);if(!this.paper.options.linkPinning&&!_.has(s.get("target"),"id")){s.remove({ui:true})}delete this._linkView}else{this.notify("element:pointerup",t,e,i);r.dedu.draw.CellView.prototype.pointerup.apply(this,arguments)}}});r.dedu.draw.Link=r.dedu.draw.Cell.extend({markup:['<path class="connection_background"/>','<path class="connection_outline"/>','<path class="connection_line"/>','<path class="marker-source" fill="black" stroke="black" />','<path class="marker-target" fill="black" stroke="black" />','<g class="labels"/>','<g class="marker-arrowheads"/>'].join(""),labelMarkup:['<g class="label">',"<rect />","<text />","</g>"].join(""),arrowheadMarkup:['<g class="marker-arrowhead-group marker-arrowhead-group-<%= end %>">','<path class="marker-arrowhead" end="<%= end %>" d="M 26 0 L 0 13 L 26 26 z" />',"</g>"].join(""),defaults:{type:"link",source:{},target:{},labels:undefined,attrs:{".marker-target":{d:"M 10 0 L 0 5 L 10 10 z"}}},label:function(t,e){t=t||0;var i=this.get("labels")||[];if(arguments.length===0||arguments.length===1){return i[t]}var r=_.merge({},i[t],e);var n=i.slice();n[t]=r;return this.set({labels:n})},getSourceElement:function(){var t=this.get("source");return t&&t.id&&this.graph&&this.graph.getCell(t.id)||null},getTargetElement:function(){var t=this.get("target");return t&&t.id&&this.graph&&this.graph.getCell(t.id)||null},isLink:function(){return true}});r.dedu.draw.LinkView=r.dedu.draw.CellView.extend({className:function(){return _.unique(this.model.get("type").split(".").concat("link")).join(" ")},initialize:function(t){this.options=_.extend({},_.result(this,"options"),t||{});r.dedu.draw.CellView.prototype.initialize.apply(this,arguments);if("function"!=typeof this.constructor.prototype.watchSource){this.constructor.prototype.watchSource=this.createWatcher("source");this.constructor.prototype.watchTarget=this.createWatcher("target")}this._labelCache={};this._markerCache={};this.startListening();this.model.on("change:selected",function(){if(this.model.get("selected")){this.focus()}else{this.unfocus()}},this);this.model.on("change:labels",function(){this.renderLabels();this.updateLabelPositions()},this)},createWatcher:function(t){var e=_.partial(this.onEndModelChange,t);function i(i,r){r=r||{};var n=null;var s=i.previous(t)||{};if(s.id){this.stopListening(this.paper.getModelById(s.id),"change",e)}if(r.id){n=this.paper.getModelById(r.id);this.listenTo(n,"change",e)}e.call(this,n,{cacheOnly:true});return this}return i},onEndModelChange:function(t,e,r){var n=!r.cacheOnly;var s=this.model.get(t)||{};if(e){var a=this.constructor.makeSelector(s);var o=t=="source"?"target":"source";var l=this.model.get(o)||{};var h=l.id&&this.constructor.makeSelector(l);if(r.handleBy===this.cid&&a==h){this[t+"BBox"]=this[o+"BBox"];this[t+"View"]=this[o+"View"];this[t+"Magnet"]=this[o+"Magnet"]}else if(r.translateBy){var d=this[t+"BBox"];d.x+=r.tx;d.y+=r.ty}else{var u=this.paper.findViewByModel(s.id);var c=u.el.querySelector(a);this[t+"BBox"]=u.getStrokeBBox(c);this[t+"View"]=u;this[t+"Magnet"]=c}if(r.handleBy===this.cid&&r.translateBy&&this.model.isEmbeddedIn(e)&&!_.isEmpty(this.model.get("vertices"))){n=false}if(!this.updatePostponed&&l.id){var f=this.paper.getModelById(l.id);if(s.id===l.id){r.handleBy=this.cid}if(r.handleBy===this.cid||r.translateBy&&f.isEmbeddedIn(r.translateBy)){this.updatePostponed=true;n=false}}}else{this[t+"BBox"]=i.rect(s.x||0,s.y||0,1,1);this[t+"View"]=this[t+"Magnet"]=null}this.lastEndChange=t;n&&this.update()},startListening:function(){var t=this.model;this.listenTo(t,"change:vertices",this.onVerticesChange);this.listenTo(t,"change:source",this.onSourceChange);this.listenTo(t,"change:target",this.onTargetChange)},onVerticesChange:function(t,e,i){this.renderVertexMarkers()},render:function(){this.$el.empty();var e=t(this.model.get("markup")||this.model.markup);if(!_.isArray(e))e=[e];this._V={};_.each(e,function(t){var e=t.attr("class");e&&(this._V[$.camelCase(e)]=t)},this);if(!this._V.connection_line)throw new Error("link: no connection path in the markup");this.renderArrowheadMarkers();this.vel.append(e);this.renderLabels();this.watchSource(this.model,this.model.get("source")).watchTarget(this.model,this.model.get("target")).update();return this},renderLabels:function(){if(!this._V.labels)return this;this._labelCache={};var e=$(this._V.labels.node).empty();var i=this.model.get("labels")||[];if(!i.length)return this;var n=_.template(this.model.get("labelMarkup")||this.model.labelMarkup);var s=t(n());_.each(i,function(i,n){var a=s.clone().node;t(a).attr("label-idx",n);this._labelCache[n]=t(a);var o=$(a).find("text");var l=$(a).find("rect");var h=_.extend({"text-anchor":"middle","font-size":14},r.dedu.draw.util.getByPath(i,"attrs/text","/"));o.attr(_.omit(h,"text"));if(!_.isUndefined(h.text)){t(o[0]).text(h.text+"")}e.append(a);var d=t(o[0]).bbox(true,e[0]);t(o[0]).translate(0,-d.height/2);var u=_.extend({fill:"white",rx:3,ry:3},r.dedu.draw.util.getByPath(i,"attrs/rect","/"));l.attr(_.extend(u,{x:d.x,y:d.y-d.height/2,width:d.width,height:d.height}))},this);return this},renderArrowheadMarkers:function(){if(!this._V.markerArrowheads)return this;var e=$(this._V.markerArrowheads.node);e.empty();var i=_.template(this.model.get("arrowheadMarkup")||this.model.arrowheadMarkup);if(this.model.get("attrs")[".marker-source"]){this._V.sourceArrowhead=t(i({end:"source"}))}if(this.model.get("attrs")[".marker-target"]){this._V.targetArrowhead=t(i({end:"target"}))}e.append(this._V.sourceArrowhead?this._V.sourceArrowhead.node:undefined,this._V.targetArrowhead?this._V.targetArrowhead.node:undefined);return this},update:function(){_.each(this.model.get("attrs"),function(t,e){var i=[];if(_.isObject(t.fill)){this.applyGradient(e,"fill",t.fill);i.push("fill")}if(_.isObject(t.stroke)){this.applyGradient(e,"stroke",t.stroke);i.push("stroke")}if(_.isObject(t.filter)){this.applyFilter(e,t.filter);i.push("filter")}if(i.length>0){i.unshift(t);t=_.omit.apply(_,i)}this.findBySelector(e).attr(t)},this);var t=this.route=this.findRoute(this.model.get("vertices")||[]);this._findConnectionPoints(t);var e=this.getPathData(t);this._V.connection_background.attr({d:e});this._V.connection_outline.attr({d:e});this._V.connection_line.attr({d:e});this._translateAndAutoOrientArrows(this._V.markerSource,this._V.markerTarget);this.updateLabelPositions();this.updateArrowheadMarkers();if(this.model.get("selected")){this._V.connection_line.attr({stroke:"#ff7f0e"})}else{this._V.connection_line.attr({stroke:"#888"})}},updateLabelPositions:function(){if(!this._V.labels)return this;var t=this.model.get("labels")||[];if(!t.length)return this;var e=this._V.connection_line.node;var r=e.getTotalLength();if(!_.isNaN(r)){var n;_.each(t,function(t,s){var a=t.position;var o=_.isObject(a)?a.distance:a;var l=_.isObject(a)?a.offset:{x:0,y:0};o=o>r?r:o;o=o<0?r+o:o;o=o>1?o:r*o;var h=e.getPointAtLength(o);if(_.isObject(l)){h=i.point(h).offset(l.x,l.y)}else if(_.isNumber(l)){if(!n){n=this._samples||this._V.connection_line.sample(this.options.sampleInterval)}var d=Infinity;var u;var c;var f;var p;for(var v=0,g=n.length;v<g;v++){f=n[v];p=i.line(f,h).squaredLength();if(p<d){d=p;u=f;c=v}}var m=n[c-1];var y=n[c+1];var w=0;if(y){w=i.point(h).theta(y)}else if(m){w=i.point(m).theta(h)}h=i.point(h).offset(l).rotate(h,w-90)}this._labelCache[s].attr("transform","translate("+h.x+", "+h.y+")")},this)}return this},updateArrowheadMarkers:function(){if(!this._V.markerArrowheads)return this;if($.css(this._V.markerArrowheads.node,"display")==="none")return this;var t=this.getConnectionLength()<this.options.shortLinkLength?.5:1;this._V.sourceArrowhead&&this._V.sourceArrowhead.scale(t);this._V.targetArrowhead&&this._V.targetArrowhead.scale(t);this._translateAndAutoOrientArrows(this._V.sourceArrowhead,this._V.targetArrowhead);return this},hideLabels:function(){$(this._V.labels.node).hide()},showLabel:function(){$(this._V.labels.node).show()},findRoute:function(t){var e=r.dedu.draw.routers;var i=this.model.get("router");var n=this.paper.options.defaultRouter;if(!i){if(this.model.get("manhattan")){i={name:"orthogonal"}}else if(n){i=n}else{return t}}},getPathData:function(t){var e=r.dedu.draw.connectors;var i=this.model.get("connector");var n=this.paper.options.defaultConnector;if(!i){if(this.model.get("smooth")){i={name:"smooth"}}else{i=n||{name:"normal"}}}var s=_.isFunction(i)?i:e[i.name];var a=i.args||{};if(!_.isFunction(s)){throw"unknown connector: "+i.name}var o=s.call(this,this._markerCache.sourcePoint,this._markerCache.targetPoint,t||(this.model.get("vertices")||{}),a,this);return o},getConnectionLength:function(){return this._V.connection_line.node.getTotalLength()},_findConnectionPoints:function(t){var e,r,n,s;var a=_.first(t);e=this.getConnectionPoint("source",this.model.get("source"),a||this.model.get("target")).round();var o=_.last(t);r=this.getConnectionPoint("target",this.model.get("target"),o||e).round();var l=this._markerCache;if(this._V.markerSource){l.sourceBBox=l.sourceBBox||this._V.markerSource.bbox(true);n=i.point(e).move(a||r,l.sourceBBox.width*this._V.markerSource.scale().sx*-1).round()}if(this._V.markerTarget){l.targetBBox=l.targetBBox||this._V.markerTarget.bbox(true);s=i.point(r).move(o||e,l.targetBBox.width*this._V.markerTarget.scale().sx*-1).round()}l.sourcePoint=n||e;l.targetPoint=s||r;this.sourcePoint=e;this.targetPoint=r},_beforeArrowheadMove:function(){this._z=this.model.get("z");this.model.toFront();this.el.style.pointerEvents="none";if(this.paper.options.markAvailable){}},_afterArrowheadMove:function(){if(!_.isUndefined(this._z)){this.model.set("z",this._z,{ui:true});delete this._z}this.el.style.pointerEvents="visiblePainted";if(this.paper.options.markAvailable){}},startArrowheadMove:function(t){this._action="arrowhead-move";this._arrowhead=t;this._initialEnd=_.clone(this.model.get(t))||{x:0,y:0};this._validateConnectionArgs=this._createValidateConnectionArgs(this._arrowhead);this._beforeArrowheadMove()},can:function(t){var e=_.isFunction(this.options.interactive)?this.options.interactive(this,"pointerdown"):this.options.interactive;if(!_.isObject(e)||e[t]!==false)return true;return false},_createValidateConnectionArgs:function(t){var e=[];e[4]=t;e[5]=this;var i;var r=0;var n=0;if(t==="source"){r=2;i="target"}else{n=2;i="source"}var s=this.model.get(i);if(s.id){e[r]=this.paper.findViewByModel(s.id);e[r+1]=s.selector&&e[r].el.querySelector(s.selector)}function a(t,i){e[n]=t;e[n+1]=t.el===i?undefined:i;return e}return a},_translateAndAutoOrientArrows:function(t,e){if(t){t.translateAndAutoOrient(this.sourcePoint,_.first(this.route)||this.targetPoint,this.paper.viewport)}if(e){e.translateAndAutoOrient(this.targetPoint,_.last(this.route)||this.sourcePoint,this.paper.viewport)}},getConnectionPoint:function(t,e,r){var n;_.isEmpty(e)&&(e={x:0,y:0});_.isEmpty(r)&&(r={
x:0,y:0});if(!e.id){n=i.point(e)}else{var s=t==="source"?this.sourceBBox:this.targetBBox;var a;if(!r.id){a=i.point(r)}else{var o=t==="source"?this.targetBBox:this.sourceBBox;a=i.rect(o).intersectionWithLineFromCenterToPoint(i.rect(s).center());a=a||i.rect(o).center()}if(this.paper.options.perpendicularLinks||this.options.perpendicular){var l=i.rect(0,a.y,this.paper.options.width,1);var h=i.rect(a.x,0,1,this.paper.options.height);var d;if(l.intersect(i.rect(s))){d=i.rect(s).sideNearestToPoint(a);switch(d){case"left":n=i.point(s.x,a.y);break;case"right":n=i.point(s.x+s.width,a.y);break;default:n=i.rect(s).center();break}}else if(h.intersect(i.rect(s))){d=i.rect(s).sideNearestToPoint(a);switch(d){case"top":n=i.point(a.x,s.y);break;case"bottom":n=i.point(a.x,s.y+s.height);break;default:n=i.rect(s).center();break}}else{n=i.rect(s).intersectionWithLineFromCenterToPoint(a);n=n||i.rect(s).center()}}else if(this.paper.options.linkConnectionPoint){var u=t==="target"?this.targetView:this.sourceView;var c=t==="target"?this.targetMagnet:this.sourceMagnet;n=this.paper.options.linkConnectionPoint(this,u,c,a)}else{n=i.rect(s).intersectionWithLineFromCenterToPoint(a);n=n||i.rect(s).center()}}return n},onSourceChange:function(t,e){this.watchSource(t,e).update()},onTargetChange:function(t,e){this.watchTarget(t,e).update()},highlight:function(t){this._V[t].attr({stroke:"#ff7f0e"})},focus:function(){this.highlight("connection_line")},unfocus:function(){this.unhighlight("connection_line")},unhighlight:function(t){this._V[t].attr({stroke:"#888"})},pointerdown:function(t,e,i){r.dedu.draw.CellView.prototype.pointerdown.apply(this,arguments);this._dx=e;this._dy=i;if(t.target.getAttribute("magnet")!=null)return;var n=_.isFunction(this.options.interactive)?this.options.interactive(this,"pointerdown"):this.options.interactive;if(n===false)return;var s=t.target.getAttribute("class");var a=t.target.parentNode.getAttribute("class");var o;if(a==="label"){s=a;o=t.target.parentNode}else{o=t.target}switch(s){case"marker-arrowhead":if(this.can("arrowheadMove")){this.startArrowheadMove(t.target.getAttribute("end"))}break;case"connection_background":this.notify("link:pointerdown",t,e,i);break}var l=t.target.parentNode.getAttribute("event");this.focus()},pointerdblclick:function(t,e,n){var s=i.line(i.point(this.sourcePoint.x,this.sourcePoint.y),i.point(this.targetPoint.x,this.targetPoint.y)).midpoint();e=s.x-8;n=s.y-8;r.dedu.draw.CellView.prototype.pointerdblclick.apply(this,arguments)},pointermove:function(e,n,s){switch(this._action){case"arrowhead-move":if(this.paper.options.snapLinks){var a=this.paper.options.snapLinks.radius||50;var o=this.paper.findViewsInArea({x:n-a,y:s-a,width:2*a,height:2*a});this._closestView&&this._closestView.unhighlight(this._closestEnd.selector,{connecting:true,snapping:true});this._closestView=this._closestEnd=null;var l;var h=Number.MAX_VALUE;var d=i.point(n,s);_.each(o,function(e){if(this.paper.findViewByModel(this.model.get("source").id)==e){return}if(e.el.getAttribute("magnet")=="true"){l=e.model.getBBox().center().distance(d);if(l<a&&l<h){if(this.paper.options.validateConnection.apply(this.paper,this._validateConnectionArgs(e,null))){h=l;this._closestView=e;this._closestEnd={id:e.model.id}}}}e.$("[magnet]").each(_.bind(function(i,r){var n=t(r).bbox(false,this.paper.viewport);l=d.distance({x:n.x+n.width/2,y:n.y+n.height/2});if(l<a&&l<h){if(this.paper.options.validateConnection.apply(this.paper,this._validateConnectionArgs(e,r))){h=l;this._closestView=e;this._closestEnd={id:e.model.id,redID:e.model.get("redID"),selector:e.getSelector(r),port:r.getAttribute("port")}}}},this))},this);this._closestView&&this._closestView.highlight(this._closestEnd.selector,{connecting:true,snapping:true});this.model.set(this._arrowhead,this._closestEnd||{x:n,y:s},{ui:true})}else{var u=e.type==="mousemove"?e.target:document.elementFromPoint(e.clientX,e.clientY);if(this._targetEvent!==u){this._magnetUnderPointer&&this._viewUnderPointer.unhighlight(this._magnetUnderPointer,{connecting:true});this._viewUnderPointer=this.paper.findView(u);if(this._viewUnderPointer){this._magnetUnderPointer=this._viewUnderPointer.findMagnet(u);if(this._magnetUnderPointer&&this.paper.options.validateConnection.apply(this.paper,this._validateConnectionArgs(this._viewUnderPointer,this._magnetUnderPointer))){this._magnetUnderPointer&&this._viewUnderPointer.highlight(this._magnetUnderPointer,{connecting:true})}else if(t(u).hasClass("tip")){console.log("collaspe")}else{this._magnetUnderPointer=null}}else{this._magnetUnderPointer=null}}this._targetEvent=u;this.model.set(this._arrowhead,{x:n,y:s},{ui:true})}break}this._dx=n;this._dy=s;r.dedu.draw.CellView.prototype.pointermove.apply(this,arguments);this.notify("link:pointermove",e,n,s)},pointerup:function(t,e,i){if(this._action==="arrowhead-move"){var n=this.paper.options;var s=this._arrowhead;if(n.snapLinks){this._closestView&&this._closestView.unhighlight(this._closestEnd.selector,{connecting:true,snapping:true});this._closestView&&this.trigger.apply(this.model,["link:complete"]);this._closestView=this._closestEnd=null}else{var a=this._viewUnderPointer;var o=this._magnetUnderPointer;delete this._viewUnderPointer;delete this._magnetUnderPointer;if(o){a.unhighlight(o,{connecting:true});var l=a.getSelector(o);var h=o.getAttribute("port");var d={id:a.model.id};if(l!=null)d.port=h;if(h!=null)d.selector=l;this.model.set(s,d,{ui:true});this.trigger.apply(this.model,"link:complete")}else{this.model.remove({ui:true})}}this._afterArrowheadMove()}delete this._action;this.notify("link:pointerup",t,e,i);r.dedu.draw.CellView.prototype.pointerup.apply(this,arguments)}},{makeSelector:function(t){var e='[model-id="'+t.id+'"]';if(t.port){e+=' [port="'+t.port+'"]'}else if(t.selector){e+=" "+t.selector}return e}});r.dedu.draw.GraphCells=Backbone.Collection.extend({cellNamespace:r.dedu.draw.shape,initialize:function(t,e){if(e.cellNamespace){this.cellNamespace=e.cellNamespace}},model:function(t,e){var i=e.collection.cellNamespace;var n=t.type==="link"?r.dedu.draw.Link:r.dedu.draw.util.getByPath(i,t.type,".")||r.dedu.draw.Element;return new n(t,e)}});r.dedu.draw.Graph=Backbone.Model.extend({initialize:function(t,e){e=e||{};var i=new r.dedu.draw.GraphCells([],{model:e.cellModel,cellNamespace:e.cellNamespace,graph:this});Backbone.Model.prototype.set.call(this,"cells",i);this.get("cells").on("all",this.trigger,this);this.get("cells").on("remove",this._removeCell,this);this._out={};this._in={};this._nodes={};this._edges={};this.selectionSet=[];i.on("add",this._restructureOnAdd,this);i.on("remove",this._restructureOnRemove,this)},_restructureOnAdd:function(t){if(t.isLink()){this._edges[t.id]=true;var e=t.get("source");var i=t.get("target");if(e.id){(this._out[e.id]||(this._out[e.id]={}))[t.id]=true}if(i.id){(this._in[i.id]||(this._in[i.id]={}))[t.id]=true}}else{this._nodes[t.id]=true}},_restructureOnRemove:function(t){if(t.isLink()){delete this._edges[t.id];var e=t.get("source");var i=t.get("target");if(e.id&&this._out[e.id]&&this._out[e.id][t.id]){delete this._out[e.id][t.id]}if(i.id&&this._in[i.id]&&this._in[i.id][t.id]){delete this._in[i.id][t.id]}}else{delete this._nodes[t.id]}},isExist:function(t){var e=this.get("cells").models;for(var i=0;i<e.length;i++){if(e[i].get("redID")==t){return true}}return false},getCellByRedID:function(t){var e=this.get("cells").models;for(var i in e){if(e[i].get("redID")==t){return e[i]}}},getCell:function(t){return this.get("cells").get(t)},getCells:function(){return this.get("cells").toArray()},getElements:function(){return this.get("cells").filter(function(t){return t instanceof r.dedu.draw.Element})},getLinks:function(){return this.get("cells").filter(function(t){return t instanceof joint.dia.Link})},selectAll:function(){this.get("cells").models.forEach(function(t){t.focus()});this.selectionSet=this.get("cells").models},getAllPosition:function(){var t={};this.get("cells").models.forEach(function(e){if(e instanceof r.dedu.draw.Element){if(e instanceof r.dedu.draw.shape.node_red.subflowportModel){t[e.get("index")-1]={position:e.get("position"),type:"subflowport"}}else{t[e.get("redID")]={position:e.get("position")}}}});return t},updateSelection:function(t){var e=_.difference(this.selectionSet,t);e.forEach(function(t){t.focus()});this.selectionSet=t},cancelSelection:function(t){var e=_.difference(this.selectionSet,t);e.forEach(function(t){t.unfocus()});this.selectionSet=[]},focus:function(t){if(this.selectionSet.indexOf(t)==-1){this.cancelSelection([t]);t.focus();this.selectionSet.push(t)}},addCell:function(t,e){this.get("cells").add(this._prepareCell(t),e||{});var i;var n=this;if(t instanceof r.dedu.draw.Link){t.on("link:complete",function(){i={source:this.get("source"),target:this.get("target"),redID:this.get("redID"),type:"link"};n.notify.apply(this,["node-red:node-link-added"].concat(i))},t)}else if(t instanceof r.dedu.draw.Element){i={redID:t.get("redID"),type:"node"};this.notify.apply(this,["node-red:node-link-added"].concat(i))}return this},addCells:function(t,e){e=e||{};e.position=t.length;_.each(t,function(t){e.position--;this.addCell(t,e)},this);return this},resetCells:function(t,e){this.get("cells").reset(_.map(t,this._prepareCell,this),e);return this},_prepareCell:function(t){var e=t instanceof Backbone.Model?t.attributes:t;if(_.isUndefined(e.z)){e.z=this.maxZIndex()+1}if(!_.isString(e.type)){throw new TypeError("dia.Graph: cell type must be a string.")}return t},maxZIndex:function(){var t=this.get("cells").last();return t?t.get("z")||0:0},clear:function(t){t=_.extend({},t,{clear:true});var e=this.get("cells").models;if(e.length===0)return this;this.trigger("batch:start",{batchName:"clear"});_.sortBy(e,function(t){return t.isLink()?1:2});do{e.shift().remove(t)}while(e.length>0);this.trigger("batch:stop",{batchName:"clear"});return this},removeSection:function(){this.get("cells").remove(this.selectionSet);var t={};for(var e=0;e<this.selectionSet.length;e++){t[this.selectionSet[e].get("redID")]=this.selectionSet[e]instanceof r.dedu.draw.Link?"link":"node"}this.notify.apply(this,["node-red:node-link-removed"].concat(t));this.selectionSet=[]},notify:function(t){var e=Array.prototype.slice.call(arguments,1);this.trigger.apply(this,[t].concat(e))}});r.dedu.draw.shape={basic:{}};r.dedu.draw.shape.basic.Generic=r.dedu.draw.Element.extend({defaults:r.dedu.draw.util.deepSupplement({type:"basic.Generic",attrs:{".":{fill:"#fff",stroke:"none",magnet:false},text:{"pointer-events":"none",stroke:"none"}}},r.dedu.draw.Element.prototype.defaults)});r.dedu.draw.shape.basic.Rect=r.dedu.draw.shape.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><rect/></g><text/></g>',defaults:r.dedu.draw.util.deepSupplement({size:{width:60,height:40},type:"basic.Rect",attrs:{rect:{fill:"#ffffff",stroke:"#000000",width:60,height:40},text:{fill:"#000000",text:"","font-size":10,"ref-x":.5,"ref-y":.5,"text-anchor":"middle","y-alignment":"middle","font-family":"Arial, helvetica, sans-serif"}}},r.dedu.draw.shape.basic.Generic.prototype.defaults)});r.dedu.draw.shape.basic.CRect=r.dedu.draw.shape.basic.Rect.extend({defaults:r.dedu.draw.util.deepSupplement({attrs:{rect:{rx:7,ry:7}}},r.dedu.draw.shape.basic.Rect.prototype.defaults)});r.dedu.draw.shape.basic.Circle=r.dedu.draw.shape.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><circle/></g><text/></g>',defaults:r.dedu.draw.util.deepSupplement({type:"basic.Circle",size:{width:60,height:60},attrs:{circle:{fill:"#ffffff",stroke:"#000000",r:30,cx:0,cy:0},text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-y":.5,"y-alignment":"middle",fill:"#000000","font-family":"Arial, helvetica, sans-serif"}}},r.dedu.draw.shape.basic.Generic.prototype.defaults)});r.dedu.draw.shape.basic.Ellipse=r.dedu.draw.shape.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><ellipse/></g><text/></g>',defaults:r.dedu.draw.util.deepSupplement({type:"basic.Ellipse",size:{width:60,height:40},attrs:{ellipse:{fill:"#ffffff",stroke:"#000000",rx:30,ry:20},text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-y":.5,"y-alignment":"middle",fill:"#000000","font-family":"Arial, helvetica, sans-serif"}}},r.dedu.draw.shape.basic.Generic.prototype.defaults)});r.dedu.draw.shape.basic.Polygon=r.dedu.draw.shape.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><polygon/></g><text/></g>',defaults:r.dedu.draw.util.deepSupplement({type:"basic.Polygon",size:{width:60,height:40},attrs:{polygon:{fill:"#ffffff",stroke:"#000000"},text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-dy":20,"y-alignment":"middle",fill:"#000000","font-family":"Arial, helvetica, sans-serif"}}},r.dedu.draw.shape.basic.Generic.prototype.defaults)});r.dedu.draw.shape.basic.Polyline=r.dedu.draw.shape.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><polyline/></g><text/></g>',defaults:r.dedu.draw.util.deepSupplement({type:"basic.Polyline",size:{width:60,height:40},attrs:{polyline:{fill:"#ffffff",stroke:"#000000"},text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-dy":20,"y-alignment":"middle",fill:"#000000","font-family":"Arial, helvetica, sans-serif"}}},r.dedu.draw.shape.basic.Generic.prototype.defaults)});r.dedu.draw.shape.basic.PortsModelInterface={initialize:function(){this.updatePortsAttrs();this.on("change:inPorts change:outPorts",this.updatePortsAttrs,this);this.constructor.__super__.constructor.__super__.initialize.apply(this,arguments)},updatePortsAttrs:function(){var t=this.get("attrs");_.each(this._portSelectors,function(e){if(t[e])delete t[e]});this._portSelectors=[];var e={};_.each(this.get("inPorts"),function(t,i,r){var n=this.getPortAttrs(t,i,r.length,".inPorts","in");this._portSelectors=this._portSelectors.concat(_.keys(n));_.extend(e,n)},this);_.each(this.get("outPorts"),function(t,i,r){var n=this.getPortAttrs(t,i,r.length,".outPorts","out");this._portSelectors=this._portSelectors.concat(_.keys(n));_.extend(e,n)},this);this.attr(e,{silent:true});this.processPorts();this.trigger("process:ports")},getPortSelector:function(t){var e=".inPorts";var i=this.get("inPorts").indexOf(t);if(i<0){e=".outPorts";i=this.get("outPorts").indexOf(t);if(i<0)throw new Error("getPortSelector(): Port doesn't exist.")}return e+">g:nth-child("+(i+1)+")>.port-body"}};r.dedu.draw.shape.basic.PortsViewInterface={initialize:function(t){if(t.skip_render){return}r.dedu.draw.ElementView.prototype.initialize.apply(this,arguments);this.listenTo(this.model,"process:ports",this.update);this.model.on("change:selected",function(){if(this.model.get("selected")){this.focus()}else{this.unfocus()}},this)},update:function(){this.renderPorts();r.dedu.draw.ElementView.prototype.update.apply(this,arguments)},renderPorts:function(){var e=this.$(".inPorts").empty();var i=this.$(".outPorts").empty();var r=_.template(this.model.portMarkup);_.each(_.filter(this.model.ports,function(t){return t.type==="in"}),function(i,n){e.append(t(r({id:n,port:i})).node)});_.each(_.filter(this.model.ports,function(t){return t.type==="out"}),function(e,n){i.append(t(r({id:n,port:e})).node)})}};r.dedu.draw.connectors.normal=function(t,e,i){var r=["M",t.x,t.y,"C"];_.each(i,function(t){r.push(t.x,t.y)});var n=Math.abs(t.x-e.x);r.push(t.x+n/2,t.y);r.push(e.x-n/2,e.y);r.push(e.x,e.y);return r.join(" ")};r.dedu.draw.shape.devs={};r.dedu.draw.shape.devs.Model=r.dedu.draw.shape.basic.Generic.extend(_.extend({},r.dedu.draw.shape.basic.PortsModelInterface,{markup:'<g class="rotatable"><g class="scalable"><rect class="body"/></g><text class="label"/><g class="inPorts"/><g class="outPorts"/></g>',portMarkup:'<g class="port port<%= id %>"><rect class="port-body"/><text class="port-label"/></g>',defaults:r.dedu.draw.util.deepSupplement({type:"devs.Model",size:{width:1,height:1},inPorts:[],outPorts:[],attrs:{".":{magnet:false},".body":{width:150,height:250,stroke:"#000000"},".port-body":{rx:3,ry:3,width:10,height:10,magnet:true,stroke:"#000000"},text:{"pointer-events":"none"},".label":{"font-size":10,text:"Model","ref-x":.5,"ref-y":10,ref:".body","text-anchor":"middle",fill:"#000000"},".inPorts .port-label":{x:-15,dy:4,"text-anchor":"end",fill:"#000000"},".outPorts .port-label":{x:15,dy:4,fill:"#000000"}}},r.dedu.draw.shape.basic.Generic.prototype.defaults),getPortAttrs:function(t,e,i,r,n){var s={};var a="port"+e;var o=r+">."+a;var l=o+">.port-label";var h=o+">.port-body";s[h]={port:{id:t||_.uniqueId(n),type:n}};s[o]={ref:".body","ref-y":(e+.5)*(1/i)*this.get("size").height-5};if(r===".outPorts"){s[o]["ref-dx"]=-5}else{s[o]["ref-x"]=-5}return s}}));r.dedu.draw.shape.devs.ModelView=r.dedu.draw.ElementView.extend(_.extend({},r.dedu.draw.shape.basic.PortsViewInterface,{focus:function(){this.vel.findOne(".body").addClass("selected")},unfocus:function(){this.vel.findOne(".body").removeClass("selected")}}));r.dedu.draw.shape.node={};r.dedu.draw.shape.node.Model=r.dedu.draw.shape.devs.Model.extend({defaults:r.dedu.draw.util.deepSupplement({markup:'<g class="rotatable"><g class="scalable"><g class="body nodegroup"/></g><text class="label"/><g class="inPorts"/><g class="outPorts"/></g>',type:"node.Model",size:{width:120,height:28},attrs:{"rect.node":{width:140,height:30},".port-body":{r:4,magnet:true,stroke:"#000000"},"rect.node_button_button_shadow":{width:32,height:26},"rect.node_button_button":{width:16,height:18},".label":{"ref-x":.5,"ref-y":.3,ref:".node","text-anchor":"middle",fill:"#000",style:{"font-weight":"normal"}}}},r.dedu.draw.shape.devs.Model.prototype.defaults),initialize:function(){this.data=this.get("data");var t=[];var e=[];for(var i=0;i<this.data.outputs;i++){t[i]="out"+i}for(i=0;i<this.data.inputs;i++){e[i]="in"+i}this.set("outPorts",t);this.set("inPorts",e);this.attr(".label/text",this.data.type);r.dedu.draw.shape.devs.Model.prototype.initialize.apply(this,arguments)}});r.dedu.draw.shape.node.ModelView=r.dedu.draw.shape.devs.ModelView.extend({options:{},renderView:function(){var e=this.vel.findOne(".nodegroup");var i=this.model.data;var r=this.model.get("size");var n=this.model.get("attrs");var s=i._def.label;s=(typeof s==="function"?s.call(i):s)||"";n[".label"].text=s;if(i._def.button){var a=t("g");e.append(a);a.attr("transform",function(){return"translate("+(i._def.align=="right"?94:-25)+",2)"}).attr("class",function(){return"node_button "+(i._def.align=="right"?"node_right_button":"node_left_button")});a.append(t("rect").attr("class","node_button_button_shadow").attr("rx",5).attr("ry",5).attr("fill","#eee"));a.append(t("rect").attr("class","node_button_button").attr("x",function(){return i._def.align=="right"?11:5}).attr("y",4).attr("rx",4).attr("ry",4).attr("fill",function(){return i._def.color}).attr("cursor","pointer"))}e.append(t("rect").attr("class","node").toggleClass("node_unknown",function(){return i.type=="unknown"}).attr("rx",5).attr("ry",5).attr("fill",function(){return i._def.color}).attr("width",r.width).attr("height",r.height));if(i._def.icon){var o=t("g").attr("class","node_icon_group").attr("x",0).attr("y",0);e.append(o);var l=t("rect").attr("x",0).attr("y",0).attr("class","node_icon_shade").attr("width","30").attr("stroke","none").attr("fill","#000").attr("fill-opacity","0.05").attr("height",function(){return Math.min(50,r.height)});o.append(l);var h=t("image").attr("xlink:href","icons/"+i._def.icon).attr("class","node_icon").attr("x",0).attr("width","30").attr("height","30");o.append(h);var d=t("path").attr("d",function(){return"M 30 1 l 0 "+(r.height-2)}).attr("class","node_icon_shade_border").attr("stroke-opacity","0.1").attr("stroke","#000").attr("stroke-width","1");o.append(d);if("right"==i._def.align){o.attr("class","node_icon_group node_icon_group_"+i._def.align);d.attr("d",function(){return"M 0 1 l 0 "+(r.height-2)})}var u=new Image;u.src="icons/"+i._def.icon;u.onload=function(){h.attr("width",Math.min(u.width,30));h.attr("height",Math.min(u.height,30));h.attr("x",15-Math.min(u.width,30)/2)};o.attr("pointer-events","none")}return this},focus:function(){this.vel.findOne(".node").addClass("selected")},unfocus:function(){this.vel.findOne(".node").removeClass("selected")}});r.dedu.draw.shape.simple={};r.dedu.draw.shape.simple.SuspendPortModelInterface={initialize:function(){}};r.dedu.draw.shape.simple.SuspendPortViewInterface={initialize:function(t){if(t.skip_render){return}r.dedu.draw.ElementView.prototype.initialize.apply(this,arguments);_.bindAll(this,"showSuspendPort","hideSuspendPort");this.$el.on("mouseenter",this.showSuspendPort);this.$el.on("mouseleave",this.hideSuspendPort);_.bindAll(this,"addTipMagnet","removeTipMagnet");this.on("cell:highlight",this.addTipMagnet);this.on("cell:unhighlight",this.removeTipMagnet);this.model.on("change:selected",function(){if(this.model.get("selected")){this.focus()}else{this.unfocus()}},this)},renderView:function(){this.renderSuspendPort()},renderSuspendPort:function(){var e=_.template(this.model.suspendPortMarkup);this.up=t(e({dir:"up"})).attr("port","up");this.right=t(e({dir:"right"})).attr("port","right");this.down=t(e({dir:"down"})).attr("port","down");this.left=t(e({dir:"left"})).attr("port","left");this.rotatableNode.append(this.up);this.rotatableNode.append(this.right);this.rotatableNode.append(this.down);this.rotatableNode.append(this.left);var i=this.model.get("port_ref_position");if(i){this.model.attr({".suspend":{ref:".body",r:3,display:"none"},".portup":{"ref-x":i.portup["ref-x"],"ref-y":i.portup["ref-y"]},".portright":{"ref-x":i.portright["ref-x"],"ref-y":i.portright["ref-y"]},".portdown":{"ref-x":i.portdown["ref-x"],"ref-y":i.portdown["ref-y"]},".portleft":{"ref-x":i.portleft["ref-x"],"ref-y":i.portleft["ref-y"]}})}else{this.model.attr({".suspend":{ref:".body",r:3,display:"none"},".portup":{"ref-x":.5,"ref-y":0},".portright":{"ref-x":"100%","ref-y":.5},".portdown":{"ref-x":.5,"ref-y":"100%"},".portleft":{"ref-y":.5,"ref-x":0}})}this.trigger("add:ports")},showSuspendPort:function(){this.up.attr("display","block");this.right.attr("display","block");this.down.attr("display","block");this.left.attr("display","block")},hideSuspendPort:function(){this.up.attr("display","none");this.right.attr("display","none");this.down.attr("display","none");this.left.attr("display","none")}};r.dedu.draw.shape.simple.Generic=r.dedu.draw.shape.basic.Generic.extend(_.extend({},r.dedu.draw.shape.basic.PortsModelInterface,{markup:'<g class="rotatable"><g class="scalable"><rect class="body"/></g><text class="label"/></g>',suspendPortMarkup:'<circle class="suspend port<%= dir %>"/>',defaults:r.dedu.draw.util.deepSupplement({type:"simple.Generic",size:{width:1,height:1},attrs:{".body":{width:150,height:250,stroke:"#000000"},".suspend":{magnet:true}}},r.dedu.draw.shape.basic.Generic.prototype.defaults),getPortAttrs:function(t,e,i,r,n){var s={};var a="port"+e;var o=r+">."+a;var l=o+">.port-label";var h=o+">.port-body";s[h]={port:{id:t||_.uniqueId(n),type:n}};s[o]={ref:".body","ref-y":(e+.5)*(1/i)};if(r===".outPorts"){s[o]["ref-dx"]=0}return s}}));r.dedu.draw.shape.simple.GenericView=r.dedu.draw.ElementView.extend(_.extend({},r.dedu.draw.shape.simple.SuspendPortViewInterface,{addTipMagnet:function(e,i){var r=t(e);if(r.attr("port")&&!$(".tip-"+r.attr("port"),this.$el)[0]){var n=t("circle",{"class":"tip tip-"+r.attr("port"),transform:r.attr("transform"),r:15,fill:"black",opacity:.3});this.rotatableNode.append(n)}this.showSuspendPort()},removeTipMagnet:function(e,i){var r=t(e);if($(".tip-"+r.attr("port"),this.$el)[0]){$(".tip.tip-"+r.attr("port"),this.$el).remove()}this.hideSuspendPort()},focus:function(){this.vel.findOne(".body").addClass("selected")},unfocus:function(){this.vel.findOne(".body").removeClass("selected")}}));r.dedu.draw.shape.uml={};r.dedu.draw.shape.uml.StartState=r.dedu.draw.shape.simple.Generic.extend({markup:['<g class="rotatable">','<g class="scalable">','<circle class="uml-start-state-body uml-state-body"/>',"</g>","</g>"].join(""),defaults:r.dedu.draw.util.deepSupplement({type:"uml.StartState",size:{width:25,height:25},port_ref_position:{portup:{"ref-x":0,"ref-y":-.5},portright:{"ref-x":.5,"ref-y":0},portdown:{"ref-x":0,"ref-y":.5},portleft:{"ref-x":-.5,"ref-y":0}},attrs:{".uml-start-state-body":{r:20,stroke:"#333",fill:"#444"}}},r.dedu.draw.shape.simple.Generic.prototype.defaults)});r.dedu.draw.shape.uml.EndState=r.dedu.draw.shape.simple.Generic.extend({markup:['<g class="rotatable">','<g class="scalable">','<circle class="uml-end-state-body uml-state-body" />','<circle class="uml-end-state-inner"/>',"</g>","</g>"].join(""),defaults:r.dedu.draw.util.deepSupplement({type:"uml.EndState",size:{width:25,height:25},port_ref_position:{portup:{"ref-x":0,"ref-y":-.5},portright:{"ref-x":.5,"ref-y":0},portdown:{"ref-x":0,"ref-y":.5},portleft:{"ref-x":-.5,"ref-y":0}},attrs:{".uml-end-state-body":{r:20,stroke:"#333"},".uml-end-state-inner":{r:10,stroke:"#333"}}},r.dedu.draw.shape.simple.Generic.prototype.defaults)});r.dedu.draw.shape.uml.State=r.dedu.draw.shape.simple.Generic.extend({markup:['<g class="rotatable">','<g class="scalable">','<rect class="uml-state-body"/>',"</g>",'<path class="uml-state-separator"/>','<text class="uml-state-name"/>','<text class="uml-state-events"/>',"</g>"].join(""),defaults:r.dedu.draw.util.deepSupplement({type:"uml.State",size:{width:60,height:40},attrs:{".uml-state-body":{width:200,height:100,rx:10,ry:10,fill:"#fff9ca",stroke:"#333","stroke-width":1},".uml-state-name":{ref:".uml-state-body","ref-x":.5,"ref-y":0,"text-anchor":"middle",fill:"#000000","font-family":"Courier New","font-size":12,"font-weight":"bold"},".uml-state-separator":{stroke:"#333","stroke-width":2},".uml-state-events":{ref:".uml-state-separator","ref-x":5,"ref-y":5,fill:"#000000","font-family":"Courier New","font-size":10,display:"block"}},events:[],name:"State"},r.dedu.draw.shape.simple.Generic.prototype.defaults)});r.dedu.draw.shape.uml.StateView=r.dedu.draw.shape.simple.GenericView.extend({initialize:function(t){if(t.skip_render){return}r.dedu.draw.shape.simple.GenericView.prototype.initialize.apply(this,arguments);this.model.on("change:name",this.updateName,this);this.model.on("change:events",this.updateEvents,this);this.model.on("change:size",this.updatePath,this)},render:function(){r.dedu.draw.shape.simple.GenericView.prototype.render.apply(this,arguments);this.originSize=this.model.get("size");this.updateName();this.updatePath();this.updateEvents()},updateEvents:function(){this.vel.findOne(".uml-state-events").text(this.model.get("events").join("\n"));var e=$(".uml-state-events",this.$el);var i=t(e[0]).bbox(true,this.$el);var r=this.originSize;this.model.set("size",{width:r.width,height:r.height+i.height})},updateName:function(){this.vel.findOne(".uml-state-name").text(this.model.get("name"))},updatePath:function(){var e=$(".uml-state-name",this.$el);var i=t(e[0]).bbox(true,this.$el);var r="M 0 "+i.height+" L "+this.model.get("size").width+" "+i.height;this.vel.findOne(".uml-state-separator").attr("d",r)},focus:function(){this.vel.findOne(".uml-state-body").attr({fill:"#ffc21d"})},unfocus:function(){this.vel.findOne(".uml-state-body").attr({fill:"#fff9ca"});this.hideSuspendPort()}});r.dedu.draw.shape.uml.StartStateView=r.dedu.draw.shape.simple.GenericView.extend({focus:function(){this.vel.findOne(".uml-state-body").attr({fill:"#ffc21d"})},unfocus:function(){this.vel.findOne(".uml-state-body").attr({fill:"#444"});this.hideSuspendPort()}});r.dedu.draw.shape.uml.EndStateView=r.dedu.draw.shape.simple.GenericView.extend({initialize:function(t){this.circle_index=2;r.dedu.draw.shape.simple.GenericView.prototype.initialize.apply(this,arguments)},focus:function(){this.vel.findOne(".uml-state-body").attr({fill:"#ffc21d"})},unfocus:function(){this.vel.findOne(".uml-state-body").attr({fill:"#fff9ca"});this.hideSuspendPort()}});r.dedu.draw.shape.uml.Class=r.dedu.draw.shape.basic.Generic.extend({markup:['<g class="rotatable">','<g class="scalable">','<rect class="uml-class-name-rect"/><rect class="uml-class-attrs-rect"/><rect class="uml-class-methods-rect"/>',"</g>",'<text class="uml-class-name-text"/><text class="uml-class-attrs-text"/><text class="uml-class-methods-text"/>',"</g>"].join(""),defaults:r.dedu.draw.util.deepSupplement({type:"uml.Class",size:{width:60,height:100},attrs:{rect:{width:200},".uml-class-name-rect":{stroke:"black","stroke-width":1,fill:"#fff9ca"},".uml-class-attrs-rect":{stroke:"black","stroke-width":1,fill:"#fff9ca"},".uml-class-methods-rect":{stroke:"black","stroke-width":1,fill:"#fff9ca"},".uml-class-name-text":{ref:".uml-class-name-rect","ref-y":.5,"ref-x":.5,"text-anchor":"middle","y-alignment":"middle","font-weight":"bold",fill:"black","font-size":12,text:"xxx"},".uml-class-attrs-text":{ref:".uml-class-attrs-rect","ref-y":5,"ref-x":5,fill:"black","font-size":12},".uml-class-methods-text":{ref:".uml-class-methods-rect","ref-y":5,"ref-x":5,fill:"black","font-size":12}},name:[],attributes:[],methods:[]},r.dedu.draw.shape.basic.Generic.prototype.defaults),initialize:function(){this.on("change:name change:attributes change:methods",function(){this.updateRectangles();this.trigger("uml-update")},this);this.updateRectangles();r.dedu.draw.shape.basic.Generic.prototype.initialize.apply(this,arguments)},getClassName:function(){return this.get("name")},updateRectangles:function(){var t=this.get("attrs");var e=[{type:"name",text:this.getClassName()},{type:"attrs",text:this.get("attributes")},{type:"methods",text:this.get("methods")}];var i=0;var r=this.get("attrs")[".uml-class-name-text"]["font-size"];_.each(e,function(e){var n=_.isArray(e.text)?e.text:[e.text];var s=n.length*r+r/2;t[".uml-class-"+e.type+"-text"].text=n.join("\n");t[".uml-class-"+e.type+"-rect"].height=s;t[".uml-class-"+e.type+"-rect"].transform="translate(0,"+i+")";i+=s})}});r.dedu.draw.shape.uml.ClassView=r.dedu.draw.ElementView.extend({initialize:function(){r.dedu.draw.ElementView.prototype.initialize.apply(this,arguments);this.listenTo(this.model,"uml-update",function(){this.update();this.resize()})}});r.dedu.draw.shape.uml.Abstract=r.dedu.draw.shape.uml.Class.extend({defaults:r.dedu.draw.util.deepSupplement({type:"uml.Abstract",attrs:{".uml-class-name-rect":{fill:"#e74c3c"},".uml-class-attrs-rect":{fill:"#c0392b"},".uml-class-methods-rect":{fill:"#c0392b"}}},r.dedu.draw.shape.uml.Class.prototype.defaults),getClassName:function(){return["<<Abstract>>",this.get("name")]}});r.dedu.draw.shape.uml.AbstractView=r.dedu.draw.shape.uml.ClassView;r.dedu.draw.shape.uml.Interface=r.dedu.draw.shape.uml.Class.extend({defaults:r.dedu.draw.util.deepSupplement({type:"uml.Interface",attrs:{".uml-class-name-rect":{fill:"#f1c40f"},".uml-class-attrs-rect":{fill:"#f39c12"},".uml-class-methods-rect":{fill:"#f39c12"}}},r.dedu.draw.shape.uml.Class.prototype.defaults),getClassName:function(){return["<<Interface>>",this.get("name")]}});r.dedu.draw.shape.uml.InterfaceView=r.dedu.draw.shape.uml.ClassView;r.dedu.draw.shape.uml.Generalization=r.dedu.draw.Link.extend({defaults:{type:"uml.Generalization",attrs:{".marker-target":{d:"M 20 0 L 0 10 L 20 20 z",fill:"white"}}}});r.dedu.draw.shape.uml.Implementation=r.dedu.draw.Link.extend({defaults:{type:"uml.Implementation",attrs:{".marker-target":{d:"M 20 0 L 0 10 L 20 20 z",fill:"white"},".connection":{"stroke-dasharray":"3,3"}}}});r.dedu.draw.shape.uml.Aggregation=r.dedu.draw.Link.extend({defaults:{type:"uml.Aggregation",attrs:{".marker-target":{d:"M 40 10 L 20 20 L 0 10 L 20 0 z",fill:"white"}}}});r.dedu.draw.shape.uml.Composition=r.dedu.draw.Link.extend({defaults:{type:"uml.Composition",attrs:{".marker-target":{d:"M 40 10 L 20 20 L 0 10 L 20 0 z",fill:"black"}}}});r.dedu.draw.shape.uml.Association=r.dedu.draw.Link.extend({defaults:{type:"uml.Association"}});r.dedu.draw.shape.node_red={};r.dedu.draw.shape.node_red.subflowportModel=r.dedu.draw.shape.devs.Model.extend({defaults:r.dedu.draw.util.deepSupplement({markup:'<g class="rotatable"><g class="scalable"><rect class="body"/></g><g class="inPorts"/><g class="outPorts"/><text class="port_label small_label"/><text class="port_label port_index"/></g>',
type:"node_red.subflowportModel",size:{width:40,height:40},attrs:{"rect.body":{rx:"8",ry:"8","stroke-dasharray":"5,5",fill:"#eee",stroke:"#999"},"text.small_label":{"stroke-width":0,fill:"#888",style:{"font-size":10},"alignment-baseline":"middle","text-anchor":"middle",ref:".body","ref-x":20,"ref-y":8,text:"output"},"text.port_index":{ref:".body","ref-x":20,"ref-y":18,text:1}}},r.dedu.draw.shape.devs.Model.prototype.defaults),initialize:function(t){this.set("outPorts",t.outputs);this.set("inPorts",t.inputs);this.get("attrs")["text.port_index"].text=t.index;r.dedu.draw.shape.devs.Model.prototype.initialize.apply(this,arguments)}});r.dedu.draw.shape.node_red.subflowportModelView=r.dedu.draw.shape.devs.ModelView.extend({renderView:function(){}});r.dedu.draw.Paper=Backbone.View.extend({className:"paper",options:{width:800,height:600,origin:{x:0,y:0},gridSize:1,perpendicularLinks:false,elementView:r.dedu.draw.ElementView,linkView:r.dedu.draw.LinkView,interactive:{labelMove:false},snapLinks:{radius:30},markAvailable:false,defaultLink:new r.dedu.draw.Link,defaultConnector:{name:"normal"},defaultRouter:null,validateMagnet:function(t,e){return e.getAttribute("magnet")!=="passive"},validateConnection:function(t,e,i,n,s,a){return(s==="target"?i:t)instanceof r.dedu.draw.ElementView},restrictTranslate:false,linkPinning:false,cellViewNamespace:r.dedu.draw.shape},constructor:function(t){this._configure(t);Backbone.View.apply(this,arguments)},_configure:function(t){if(this.options)t=_.merge({},_.result(this,"options"),t);this.options=t},initialize:function(){this.lasso=null;this.mouse_mode=0;this.svg=t("svg").node;this.viewport=t("g").addClass("viewport").node;this.vis=t("g").addClass("vis").node;this.outer_background=t("rect").node;this.defs=t("defs").node;t(this.svg).append([this.viewport,this.defs]);t(this.viewport).append(this.vis);t(this.vis).append(this.outer_background);this.$el.append(this.svg);this.listenTo(this.model,"add",this.onCellAdded);this.listenTo(this.model,"remove",this.removeView);this.listenTo(this.model,"reset",this.resetViews);this.listenTo(this.model,"sort",this.sortViews);this.setOrigin();this.setDimensions();this._views={};this.on({"blank:pointerdown":this.blank_pointDown,"blank:pointermove":this.blank_pointMove,"blank:pointerup":this.blank_pointUp});this.on({"cell:highlight":this.onCellHighlight,"cell:unhighlight":this.onCellUnhighlight})},events:{"mousedown .vis":"canvasMouseDown","mousemove .vis":"canvasMouseMove","mouseup .vis":"canvasMouseUp","mouseover .element":"cellMouseover",dblclick:"mousedblclick",click:"mouseclick"},onCellAdded:function(t,e,i){this.renderView(t)},removeView:function(t){var e=this._views[t.id];if(e){e.remove();delete this._views[t.id]}return e},resetViews:function(){console.log("rest")},sortViews:function(){console.log("sort")},findViewByModel:function(t){var e=_.isString(t)?t:t.id;return this._views[e]},findViewsInArea:function(t,e){e=_.defaults(e||{},{strict:false});t=i.rect(t);var r=_.map(this.model.getElements(),this.findViewByModel,this);var n=e.strict?"containsRect":"intersect";return _.filter(r,function(e){return e&&t[n](i.rect(e.vel.bbox(false,this.viewport)))},this)},getModelById:function(t){return this.model.getCell(t)},renderView:function(e){var i=this._views[e.id]=this.createViewForModel(e);t(this.vis).append(i.el);i.paper=this;i.render();return i},findView:function(t){var e=_.isString(t)?this.viewport.querySelector(t):t instanceof $?t[0]:t;while(e&&e!==this.el&&e!==document){var i=e.getAttribute("model-id");if(i)return this._views[i];e=e.parentNode}return undefined},getArea:function(){var t=this.viewport.getCTM().inverse()},getRestrictedArea:function(){var t;if(_.isFunction(this.options.restrictTranslate)){}else if(this.options.restrictedTranslate===true){t=this.getArea()}else{t=this.options.restrictTranslate||null}return t},snapToGrid:function(e){var r=t(this.viewport).toLocalPoint(e.x,e.y);return{x:i.snapToGrid(r.x,this.options.gridSize),y:i.snapToGrid(r.y,this.options.gridSize)}},createViewForModel:function(t){var e;var i;var n=this.options.cellViewNamespace;var s=t.get("type")+"View";var a=r.dedu.draw.util.getByPath(n,s,".");if(t.isLink()){e=this.options.linkView;i=r.dedu.draw.LinkView}else{e=this.options.elementView;i=r.dedu.draw.ElementView}var o=e.prototype instanceof Backbone.View?a||e:e.call(this,t)||a||i;return new o({model:t,interactive:this.options.interactive,paper:this})},setOrigin:function(e,i){this.options.origin.x=e||0;this.options.origin.y=i||0;t(this.viewport).translate(e,i,{absolut:true});this.trigger("translate",e,i)},setDimensions:function(e,i){e=this.options.width=e||this.options.width;i=this.options.height=i||this.options.height;t(this.svg).attr({width:e,height:i});t(this.outer_background).attr({width:e,height:i,fill:"#fff"});this.trigger("resize",e,i)},onCellHighlight:function(e,i){t(i).addClass("highlighted")},onCellUnhighlight:function(e,i){t(i).removeClass("highlighted")},blank_pointDown:function(e,i,r){this.model.cancelSelection();var n=this.lasso;var s=this.mouse_mode;if(s===0){if(n){n.remove();n=null}var a=[i,r];var o=t("rect").attr("ox",a[0]).attr("oy",a[1]).attr("rx",1).attr("ry",1).attr("x",a[0]).attr("y",a[1]).attr("width",0).attr("height",0).attr("class","lasso");this.lasso=o;t(this.vis).append(o)}this.trigger("blank_pointDown")},blank_pointMove:function(t,e,i){var r=[t.offsetX,t.offsetY];var n=this.lasso;var s=this.mouse_mode;if(n){var a=parseInt(n.attr("ox"));var o=parseInt(n.attr("oy"));var e=parseInt(n.attr("x"));var i=parseInt(n.attr("y"));var l;var h;if(r[0]<a){e=r[0];l=a-e}else{l=r[0]-e}if(r[1]<o){i=r[1];h=o-i}else{h=r[1]-i}n.attr("x",e).attr("y",i).attr("width",l).attr("height",h);return}},blank_pointUp:function(t,e,i){var n=this.lasso;var s=this.mouse_mode;if(n){this.model.selectionSet=[];var e=parseInt(n.attr("x"));var i=parseInt(n.attr("y"));var a=e+parseInt(n.attr("width"));var o=i+parseInt(n.attr("height"));var l=[];_.each(this._views,function(t){if(t instanceof r.dedu.draw.LinkView){return}var n=t.model;var s=n.get("position");n.set("selected",s.x>e&&s.x<a&&s.y>i&&s.y<o);if(n.get("selected")){l.push(t.model)}},this);this.model.updateSelection(l);n.remove();n=null}this.trigger("paper:selection_create",t)},canvasMouseDown:function(t){t.preventDefault();var t=r.dedu.draw.util.normalizeEvent(t);var e=this.findView(t.target);if(this.guard(t,e))return;var i=this.snapToGrid({x:t.clientX,y:t.clientY});if(e){if(this.guard(t,e))return;this.model.focus(e.model);this.sourceView=e;this.sourceView.pointerdown(t,i.x,i.y)}else{this.trigger("blank:pointerdown",t,i.x,i.y)}this.trigger("paper:selection_create",t)},canvasMouseMove:function(t){t.preventDefault();t=r.dedu.draw.util.normalizeEvent(t);var e=this.snapToGrid({x:t.clientX,y:t.clientY});if(this.sourceView){if(this.sourceView instanceof r.dedu.draw.LinkView){this.sourceView.pointermove(t,e.x,e.y);return}var n=this.options.gridSize;var s=this.sourceView.model.get("position");var a=i.snapToGrid(s.x,n)-s.x+i.snapToGrid(e.x-this.sourceView._dx,n);var o=i.snapToGrid(s.y,n)-s.y+i.snapToGrid(e.y-this.sourceView._dy,n);this.sourceView._dx=i.snapToGrid(e.x,n);this.sourceView._dy=i.snapToGrid(e.y,n);_.each(this.model.selectionSet,function(i){this.findViewByModel(i).pointermove(t,a,o,e)},this)}else{this.trigger("blank:pointermove",t,e.x,e.y)}},canvasMouseUp:function(t){t=r.dedu.draw.util.normalizeEvent(t);var e=this.snapToGrid({x:t.clientX,y:t.clientY});if(this.sourceView){this.sourceView.pointerup(t,e.x,e.y);this.sourceView=null}else{this.trigger("blank:pointerup",t,e.x,e.y)}},mousedblclick:function(t){t.preventDefault();t=r.dedu.draw.util.normalizeEvent(t);var e=this.findView(t.target);if(this.guard(t,e))return;var i=this.snapToGrid({x:t.clientX,y:t.clientY});if(e){e.pointerdblclick(t,i.x,i.y)}else{this.trigger("blank:pointerdblclick",t,i.x,i.y)}},mouseclick:function(t){if(this._mousemoved<=this.options.clickThreshold){t=r.dedu.draw.util.normalizeEvent(t);var e=this.findView(t.target);if(this.guard(t,e))return;var i=this.snapToGrid({x:t.clientX,y:t.clientY});if(e){e.pointerclick(t,i.x,i.y)}else{this.trigger("blank:pointerclick",t,i.x,i.y)}}this._mousemoved=0},cellMouseover:function(t){t=r.dedu.draw.util.normalizeEvent(t);var e=this.findView(t.target);if(e){if(this.guard(t,e))return;e.mouseover(t)}},guard:function(t,e){if(e&&e.model&&e.model instanceof r.dedu.draw.Cell){return false}else if(this.svg===t.target||this.el===t.target||$.contains(this.svg,t.target)){return false}return true},getDefaultLink:function(t,e){return _.isFunction(this.options.defaultLink)?this.options.defaultLink.call(this,t,e):this.options.defaultLink.clone()}});r.dedu.draw.Chart=r.dedu.draw.Paper.extend({options:r.dedu.draw.util.supplement({tabindex:1,style:{}},r.dedu.draw.Paper.prototype.options),initialize:function(){r.dedu.draw.Paper.prototype.initialize.apply(this,arguments);t(this.svg).attr({tabindex:this.options.tabindex});var e="";_.each(this.options.style,function(t,i){e+=i+":"+t+";"});t(this.svg).attr({style:e})}});r.dedu.draw.plugins={};r.dedu.draw.plugins.PlainSvg=function(){var e=r.dedu.draw.shape;var i=r.dedu.draw.ElementView;var n=null;function s(e,i){var r=a(e,i);t(n.vis).append(r.el);r.paper=n;r.render();return r}function a(t,s){var a=t+"View";var o=r.dedu.draw.util.getByPath(e,a,".");var l=r.dedu.draw.util.getByPath(e,t,".");var h=o||i;var d=new l(s);var u=new h({model:d,skip_render:true,paper:n});return u}function o(t,e){var i=$('<svg style="width: 36px; height: 36px; display: block; position: relative; overflow: hidden; cursor: move; "></svg>');var r=s(t,e);i.append($(r.el));delete r.model;delete r;return i}return{getPaleteeSvg:o}}();return r});